<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="format-detection" content="telephone=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>LIMEN Helix – The Threshold v3</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;overflow:hidden;height:100vh;width:100vw;font-family:Georgia,serif}
#matrix{position:fixed;inset:0;z-index:1}
#kaleidoscope{position:fixed;inset:0;z-index:2}
#fireRing{position:fixed;inset:0;z-index:12;pointer-events:none}

/* Gate */
#gate{position:fixed;inset:0;z-index:10;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer}
#gate::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 20%,rgba(0,0,0,0.25) 55%,rgba(0,0,0,0.65) 100%);pointer-events:none;z-index:1}

/* Corner glyphs */
.cg{position:absolute;font-size:1.4rem;color:rgba(201,169,78,0.3);letter-spacing:4px;z-index:3;animation:gb 5s ease-in-out infinite;text-shadow:0 0 15px rgba(201,169,78,0.2)}
.cg.tl{top:1.5rem;left:1.5rem}.cg.tr{top:1.5rem;right:1.5rem;animation-delay:1.2s}.cg.bl{bottom:1.5rem;left:1.5rem;animation-delay:2.5s}.cg.br{bottom:1.5rem;right:1.5rem;animation-delay:3.7s}
@keyframes gb{0%,100%{opacity:.3;text-shadow:0 0 15px rgba(201,169,78,0.2)}50%{opacity:.8;text-shadow:0 0 30px rgba(201,169,78,0.5)}}

/* THE EYE */
#eye-container{position:relative;z-index:3;width:80vmin;max-width:700px;height:42vmin;max-height:360px}
#eyeCanvas{width:100%;height:100%}

/* Text below eye */
#gt{text-align:center;z-index:3;margin-top:2.5rem;background:radial-gradient(ellipse at center,rgba(0,0,0,0.85) 0%,rgba(0,0,0,0.6) 60%,transparent 100%);padding:1.5rem 3rem;border-radius:8px}
#gt1{font-size:.7rem;letter-spacing:12px;color:rgba(201,169,78,0.7);text-transform:uppercase;font-family:monospace;margin-bottom:.6rem;text-shadow:0 0 25px rgba(201,169,78,0.4)}
#gt2{font-size:.85rem;color:rgba(201,169,78,0.3);letter-spacing:4px;font-style:italic;text-shadow:0 0 15px rgba(201,169,78,0.2)}
#gt3{font-size:.55rem;letter-spacing:5px;color:rgba(255,80,60,0.4);text-transform:uppercase;font-family:monospace;margin-top:1.2rem;font-weight:bold;animation:warn 3s ease-in-out infinite;text-shadow:0 0 10px rgba(255,40,20,0.3)}
@keyframes warn{0%,100%{opacity:.4;text-shadow:0 0 10px rgba(255,40,20,0.3)}50%{opacity:.9;text-shadow:0 0 25px rgba(255,40,20,0.6)}}
#gate:hover #gt1{color:rgba(201,169,78,1);text-shadow:0 0 35px rgba(201,169,78,0.6)}
#gate:hover #gt2{color:rgba(201,169,78,0.5)}
#gate:hover #gt3{color:rgba(255,80,60,0.6)}
#gate:hover .cg{color:rgba(201,169,78,0.5)}

/* Portal */
#portal{position:fixed;inset:0;z-index:200;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0);transition:background 1.5s ease}
#portal *{position:relative;z-index:1}
#vr{width:0;height:0;border-radius:50%;background:radial-gradient(ellipse at center,rgba(8,5,18,0.97) 0%,rgba(2,1,5,0.99) 100%);transition:all 2s cubic-bezier(0.16,1,0.3,1);display:flex;align-items:center;justify-content:center;overflow:visible;position:relative}
#pc{opacity:0;transform:scale(0.85);transition:all 1s ease;text-align:center;padding:1.5rem;width:100%;max-width:500px}
#pc.vis{opacity:1;transform:scale(1)}
.ctp{font-size:.45rem;letter-spacing:8px;color:#C9A94E;text-transform:uppercase;font-family:monospace;margin-bottom:.5rem}
.ctt{font-size:1.9rem;color:#f8eacb;font-weight:300;margin-bottom:.3rem}
.cts{font-size:1rem;color:#888;line-height:1.9;margin-bottom:1.8rem;font-style:italic;font-weight:600;text-shadow:0 0 10px rgba(201,169,78,0.15)}
.og{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:1.2rem}
.oc{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:22px 14px;border:1px solid rgba(201,169,78,0.15);background:rgba(201,169,78,0.02);text-decoration:none;cursor:pointer;transition:all .4s;overflow:hidden;border-radius:3px}
.oc:hover{border-color:rgba(201,169,78,0.5);background:rgba(201,169,78,0.08);box-shadow:0 0 40px rgba(201,169,78,0.08)}
.oi{font-size:1.8rem;margin-bottom:8px;display:block}.on{font-size:.6rem;letter-spacing:4px;color:#C9A94E;text-transform:uppercase;display:block}.od{font-size:.5rem;color:#555;margin-top:5px;letter-spacing:1px;display:block}
.pb{display:inline-block;background:none;border:1px solid rgba(201,169,78,0.12);color:#444;padding:10px 28px;font-size:.55rem;letter-spacing:3px;cursor:pointer;text-transform:uppercase;font-family:monospace;transition:all .3s;text-decoration:none;margin-top:1rem}
.pb:hover{color:#C9A94E;border-color:rgba(201,169,78,0.35)}
.gate-opening{opacity:0!important;transition:opacity 1.2s!important}
@media(max-width:600px){#eye-container{width:95vmin;height:50vmin}.cg{font-size:1rem}#gt1{font-size:.5rem;letter-spacing:8px}#gt2{font-size:.6rem}#gt3{font-size:.4rem;letter-spacing:3px}#gt{padding:1rem 1.5rem}.ctt{font-size:1.5rem}.og{gap:6px}.oc{padding:16px 10px}}
</style>
</head>
<body>
<canvas id="matrix"></canvas>
<canvas id="kaleidoscope"></canvas>
<canvas id="fireRing"></canvas>

<div id="gate" onclick="openThreshold()">
  <span class="cg tl">Ω · Α</span><span class="cg tr">Δ · Σ</span>
  <span class="cg bl">Ψ · Θ</span><span class="cg br">Φ · Λ</span>
  <div id="eye-container"><canvas id="eyeCanvas"></canvas></div>
  <div id="gt">
    <div id="gt1">Enter the Threshold</div>
    <div id="gt2">seek what lies beyond the pattern</div>
    <div id="gt3">⚠ THE TRUTH LIVES BEYOND THIS POINT · THERE IS NO GOING BACK ⚠</div>
  </div>
</div>

<div id="portal">
  <div id="vr">
    <div id="pc">
      <p class="ctp">You have crossed the limen</p>
      <h1 class="ctt">The Inner Chamber</h1>
      <p class="cts">What you offer here feeds the pattern.<br>What returns to you is the architecture of your own becoming.</p>
      <div class="og">
        <a href="spiral.html" class="oc" onclick="event.stopPropagation()"><span class="oi">⊘</span><span class="on">The Spiral</span><span class="od">Phases · Knowledge · Spells</span></a>
        <a href="ceremony.html" class="oc" onclick="event.stopPropagation()"><span class="oi">☽</span><span class="on">Ceremony</span><span class="od">Sacred Events · Rituals</span></a>
        <a href="https://chapel-pos-v2.vercel.app" target="_blank" rel="noopener" class="oc" onclick="event.stopPropagation()"><span class="oi">⊕</span><span class="on">Consultation</span><span class="od">1-on-1 · Guidance</span></a>
        <a href="https://chapel-pos-v2.vercel.app" target="_blank" rel="noopener" class="oc" onclick="event.stopPropagation()"><span class="oi">✦</span><span class="on">The Offering</span><span class="od">Tithe · Unlock Phases</span></a>
      </div>
      <button class="pb" onclick="closeThreshold()">← Return to Gate</button>
      <p style="font-size:.35rem;color:rgba(201,169,78,0.06);margin-top:1.2rem;letter-spacing:4px;text-transform:uppercase">Chapel of the LIMEN Helix · 501(c)(3) · EIN <span style="unicode-bidi:bidi-override;direction:ltr">33&#8209;4945631</span></p>
    </div>
  </div>
</div>

<script>
// ═══ GREEK WORDS ═══
var words=['ΛΙΜΕΝ','ΕΛΙΞ','ΦΑΣΙΣ','ΚΑΤΩΦΛΙ','ΣΠΕΙΡΑ','ΕΠΙΣΤΡΟΦΗ','ΜΕΤΑΜΟΡΦΩΣΗ','ΑΝΑΓΕΝΝΗΣΗ','ΦΑΣΗ ΜΗΔΕΝ','ΠΗΓΗ','ΔΙΑΛΥΣΗ','ΑΝΑΔΥΣΗ','ΣΤΑΘΕΡΟΤΗΤΑ','ΕΝΣΩΜΑΤΩΣΗ','ΥΠΕΡΒΑΣΗ','ΚΥΚΛΟΣ','ΜΟΤΙΒΟ','ΤΕΛΕΤΟΥΡΓΙΑ','ΜΥΗΣΗ','ΑΠΟΚΑΛΥΨΗ','ΘΕΟΣ','ΛΟΓΟΣ','ΠΝΕΥΜΑ','ΑΓΑΠΗ','ΔΗΜΙΟΥΡΓΟΣ','ΑΙΩΝΙΟΣ','ΦΩΤΕΙΝΟΣ','ΑΓΙΟΣ','ΘΕΙΑ ΤΑΞΗ','ΟΥΡΑΝΟΣ','ΑΛΗΘΕΙΑ','ΣΟΦΙΑ','ΑΡΜΟΝΙΑ','ΑΝΑΛΗΨΗ','ΧΑΡΙΣ','ΕΛΕΟΣ','ΛΥΤΡΩΣΗ','ΑΝΑΣΤΑΣΙΣ','ΣΑΤΑΝ','ΕΩΣΦΟΡΟΣ','ΣΚΟΤΟΣ','ΠΤΩΣΗ','ΔΑΙΜΩΝ','ΠΕΙΡΑΣΜΟΣ','ΣΚΙΑ','ΑΒΥΣΣΟΣ','ΧΑΟΣ','ΑΠΟΣΤΑΣΙΑ','ΠΛΑΝΗ','ΟΦΙΣ','ΑΠΟΚΡΥΦΑ','ΓΝΩΣΗ','ΜΥΣΤΗΡΙΟ','ΣΥΝΩΜΟΣΙΑ','ΕΛΕΓΧΟΣ','ΤΡΙΤΟ ΜΑΤΙ','ΠΥΡΑΜΙΔΑ','ΑΦΥΠΝΙΣΗ','ΚΟΚΚΙΝΟ ΧΑΠΙ','ΜΗΤΡΑ','ΝΕΥΡΩΝΑΣ','ΣΥΝΑΨΗ','ΕΓΚΕΦΑΛΟΣ','ΑΜΥΓΔΑΛΗ','ΙΠΠΟΚΑΜΠΟΣ','ΝΕΥΡΙΚΟ ΣΥΣΤΗΜΑ','ΝΕΥΡΟΠΛΑΣΤΙΚΟΤΗΤΑ','ΝΤΟΠΑΜΙΝΗ','ΣΕΡΟΤΟΝΙΝΗ','ΚΟΡΤΙΖΟΛΗ','ΑΔΡΕΝΑΛΙΝΗ','ΩΚΥΤΟΚΙΝΗ','ΟΜΟΙΟΣΤΑΣΙΣ','ΕΝΤΡΟΠΙΑ','ΕΝΕΡΓΕΙΑ','ΣΥΧΝΟΤΗΤΑ','ΔΟΝΗΣΗ','ΚΒΑΝΤΙΚΟ','ΦΡΑΚΤΑΛ','ΧΡΥΣΗ ΤΟΜΗ','ΙΕΡΑ ΓΕΩΜΕΤΡΙΑ','ΚΟΥΝΤΑΛΙΝΙ','ΤΣΑΚΡΑ'];
var greekChars='ΩΔΨΦΛΣΘΑΒΓΕΖΗΙΚΜΝΞΟΠΡΤΥΧωδψφλσθαβγεζηικμνξοπρτυχ∞∑∏∫√∂'.split('');

// ═══ MATRIX RAIN ═══
// ═══ CANVAS DPI FIX ═══
var dpr=window.devicePixelRatio||1;

var mc=document.getElementById('matrix'),mx=mc.getContext('2d');
mc.width=window.innerWidth*dpr;mc.height=window.innerHeight*dpr;
mc.style.width=window.innerWidth+'px';mc.style.height=window.innerHeight+'px';
mx.scale(dpr,dpr);
var fontSize=12,cols=Math.floor(window.innerWidth/(fontSize*0.5));
var drops=[],colWords=[],colCharIdx=[];
for(var i=0;i<cols;i++){drops[i]=Math.random()*-100;colWords[i]=Math.random()<0.4?words[Math.floor(Math.random()*words.length)]:'';colCharIdx[i]=0}

function drawMatrix(){
  mx.fillStyle='rgba(0,0,0,0.035)';
  mx.fillRect(0,0,window.innerWidth,window.innerHeight);
  for(var i=0;i<drops.length;i++){
    var ch;
    if(colWords[i]&&colCharIdx[i]<colWords[i].length){ch=colWords[i][colCharIdx[i]];colCharIdx[i]++}
    else{ch=greekChars[Math.floor(Math.random()*greekChars.length)];if(Math.random()<0.02){colWords[i]=words[Math.floor(Math.random()*words.length)];colCharIdx[i]=0}}
    var x=i*(fontSize*0.5),y=drops[i]*fontSize,c=Math.random();
    if(c<0.35){mx.fillStyle='rgba(201,169,78,'+(0.6+Math.random()*0.4)+')';mx.shadowColor='rgba(201,169,78,0.7)'}
    else if(c<0.55){mx.fillStyle='rgba(160,100,255,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(160,100,255,0.6)'}
    else if(c<0.7){mx.fillStyle='rgba(80,180,255,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(80,180,255,0.6)'}
    else if(c<0.85){mx.fillStyle='rgba(255,80,180,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(255,80,180,0.6)'}
    else{mx.fillStyle='rgba(255,160,40,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(255,160,40,0.6)'}
    mx.shadowBlur=8+Math.random()*8;mx.font=(fontSize-2+Math.random()*4)+'px monospace';mx.fillText(ch,x,y);mx.shadowBlur=0;
    if(y>window.innerHeight&&Math.random()>0.98){drops[i]=0;colWords[i]=Math.random()<0.4?words[Math.floor(Math.random()*words.length)]:'';colCharIdx[i]=0}
    drops[i]+=0.25+Math.random()*0.35;
  }
  requestAnimationFrame(drawMatrix);
}
drawMatrix();

// ═══ KALEIDOSCOPE ═══
var kc=document.getElementById('kaleidoscope'),kx=kc.getContext('2d');
kc.width=window.innerWidth*dpr;kc.height=window.innerHeight*dpr;
kc.style.width=window.innerWidth+'px';kc.style.height=window.innerHeight+'px';
kx.scale(dpr,dpr);
var t=0;
function drawK(){
  kx.clearRect(0,0,window.innerWidth,window.innerHeight);
  var cx=window.innerWidth/2,cy=window.innerHeight/2,maxR=Math.min(window.innerWidth,window.innerHeight)*0.48;
  for(var arm=0;arm<12;arm++){
    var ba=(arm/12)*Math.PI*2+t*0.15;kx.beginPath();
    for(var i=0;i<300;i++){var r=i/300,a=ba+r*Math.PI*6+Math.sin(t*0.3+r*4)*0.8,rr=r*maxR,w=Math.sin(t*2+r*10+arm)*rr*0.02;
    var px=cx+Math.cos(a)*(rr+w),py=cy+Math.sin(a)*(rr+w);if(i===0)kx.moveTo(px,py);else kx.lineTo(px,py)}
    kx.strokeStyle='hsla('+((arm*30+t*25)%360)+',80%,60%,'+(0.04+Math.sin(t*0.5+arm)*0.02)+')';kx.lineWidth=1.2;kx.stroke();
  }
  for(var l=0;l<8;l++){
    var lr=maxR*(0.1+l*0.11),s=3+l,rot=t*(l%2===0?0.2:-0.2)+l*0.4;kx.beginPath();
    for(var si=0;si<=s;si++){var a=(si/s)*Math.PI*2+rot,p=Math.sin(t*1.5+l+si)*lr*0.04;
    var px=cx+Math.cos(a)*(lr+p),py=cy+Math.sin(a)*(lr+p);if(si===0)kx.moveTo(px,py);else kx.lineTo(px,py)}
    kx.closePath();kx.strokeStyle='hsla('+((l*45+t*20+120)%360)+',70%,55%,'+(0.06+Math.sin(t+l)*0.03)+')';kx.lineWidth=1+l*0.15;kx.stroke();
  }
  t+=0.012;requestAnimationFrame(drawK);
}
drawK();

// ═══ THE EYE — canvas drawn, reacts to hover ═══
var ec=document.getElementById('eyeCanvas'),ex=ec.getContext('2d');
var eyeOpen=0;// 0=closed, 1=fully open
var eyeTarget=0;
var eyeT=0;
var eyeClicked=false;

// Load the eye photograph
var eyeImg=new Image();
eyeImg.src='eye-cropped.jpg';

// Pupil tracking
var pupilX=0,pupilY=0; // -1 to 1 range
var pupilTargetX=0,pupilTargetY=0;
var breathPhase=0; // Breathing pulse for closed eye

// Track mouse position relative to eye
document.addEventListener('mousemove',function(e){
  var cont=document.getElementById('eye-container');
  if(!cont)return;
  var r=cont.getBoundingClientRect();
  var centerX=r.left+r.width/2;
  var centerY=r.top+r.height/2;
  var dx=(e.clientX-centerX)/(window.innerWidth/2);
  var dy=(e.clientY-centerY)/(window.innerHeight/2);
  var dist=Math.sqrt(dx*dx+dy*dy);
  var maxDist=0.7;// limit how far pupil can move
  if(dist>maxDist){dx=dx/dist*maxDist;dy=dy/dist*maxDist;}
  pupilTargetX=dx;pupilTargetY=dy;
});

// Track touch position
document.addEventListener('touchmove',function(e){
  if(!e.touches[0])return;
  var cont=document.getElementById('eye-container');
  if(!cont)return;
  var r=cont.getBoundingClientRect();
  var centerX=r.left+r.width/2;
  var centerY=r.top+r.height/2;
  var dx=(e.touches[0].clientX-centerX)/(window.innerWidth/2);
  var dy=(e.touches[0].clientY-centerY)/(window.innerHeight/2);
  var dist=Math.sqrt(dx*dx+dy*dy);
  var maxDist=0.7;
  if(dist>maxDist){dx=dx/dist*maxDist;dy=dy/dist*maxDist;}
  pupilTargetX=dx;pupilTargetY=dy;
},{passive:true});

function resizeEye(){
  var cont=document.getElementById('eye-container');
  ec.width=cont.offsetWidth*2;ec.height=cont.offsetHeight*2;// 2x for retina
}
resizeEye();

function drawEye(){
  var w=ec.width,h=ec.height,cx=w/2,cy=h/2;
  ex.clearRect(0,0,w,h);
  eyeOpen+=(eyeTarget-eyeOpen)*0.05;
  eyeT+=0.015;
  breathPhase+=0.02;
  
  // Smooth pupil tracking
  pupilX+=(pupilTargetX-pupilX)*0.08;
  pupilY+=(pupilTargetY-pupilY)*0.08;
  
  // Pupil offset in canvas coords — scales with eye openness
  var maxPupilOffset=w*0.06*eyeOpen;
  var pxOff=pupilX*maxPupilOffset;
  var pyOff=pupilY*maxPupilOffset*0.6;// less vertical range
  
  var eyeW=w*0.48;
  var eyeH=h*0.48*eyeOpen;
  
  // Breathing pulse on closed slit
  var breathGlow=0.15+Math.sin(breathPhase)*0.1;
  
  // ALL-SEEING EYE RAYS — visible even when closed, radiating from behind
  if(eyeOpen>0.01||true){
    var rayAlpha=0.02+eyeOpen*0.06;
    for(var r=0;r<60;r++){
      var a=(r/60)*Math.PI*2+eyeT*0.08+Math.sin(r*0.5)*0.1;
      var rLen=Math.max(w,h)*(0.3+Math.sin(eyeT+r*1.1)*0.15);
      ex.beginPath();ex.moveTo(cx,cy);
      ex.lineTo(cx+Math.cos(a)*rLen,cy+Math.sin(a)*rLen);
      var rc=r%5;
      if(rc===0)ex.strokeStyle='rgba(201,169,78,'+rayAlpha+')';
      else if(rc===1)ex.strokeStyle='rgba(140,200,255,'+rayAlpha*0.7+')';
      else if(rc===2)ex.strokeStyle='rgba(255,255,255,'+rayAlpha*0.5+')';
      else if(rc===3)ex.strokeStyle='rgba(200,140,255,'+rayAlpha*0.6+')';
      else ex.strokeStyle='rgba(255,200,130,'+rayAlpha*0.8+')';
      ex.lineWidth=0.5+Math.sin(eyeT*2+r)*0.5;
      ex.stroke();
    }
  }
  
  if(eyeOpen>0.03){
    // Clip to eye shape
    ex.save();
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.55,cy-eyeH*1.45,cx+eyeW*0.55,cy-eyeH*1.45,cx+eyeW,cy);
    ex.bezierCurveTo(cx+eyeW*0.55,cy+eyeH*1.1,cx-eyeW*0.55,cy+eyeH*1.1,cx-eyeW,cy);
    ex.closePath();
    ex.clip();
    
    // Draw the actual photograph — cover the entire eye shape
    if(eyeImg&&eyeImg.complete&&eyeImg.naturalWidth>0){
      // Scale image to cover the eye opening fully
      var imgAspect=eyeImg.naturalWidth/eyeImg.naturalHeight;
      var drawW=eyeW*2.8;
      var drawH=drawW/imgAspect;
      // If height doesn't cover with tracking headroom, scale up
      if(drawH<eyeH*3.2){
        drawH=eyeH*3.2;
        drawW=drawH*imgAspect;
      }
      // Pupil is ~8.4% left and ~3.1% above center in the photo
      // Shift image so pupil aligns with canvas center
      var pupilOffX=drawW*0.084;
      var pupilOffY=drawH*0.031;
      ex.drawImage(eyeImg,cx-drawW/2+pupilOffX,cy-drawH/2+pupilOffY,drawW,drawH);
    }
    
    // Supernatural overlay — very subtle golden pulse inside the eye
    var superAlpha=0.04*eyeOpen*Math.abs(Math.sin(eyeT*0.8));
    var superGlow=ex.createRadialGradient(cx+pxOff,cy+pyOff,0,cx,cy,eyeW*0.8);
    superGlow.addColorStop(0,'rgba(201,169,78,'+superAlpha*2+')');
    superGlow.addColorStop(0.4,'rgba(100,150,220,'+superAlpha+')');
    superGlow.addColorStop(1,'rgba(0,0,0,0)');
    ex.fillStyle=superGlow;
    ex.fillRect(0,0,w,h);
    
    // Micro lightning around pupil area — very subtle supernatural hints
    var pupilArea=eyeH*0.18;
    var pCx=cx+pxOff*1.2,pCy=cy+pyOff*1.2;
    for(var arc=0;arc<8;arc++){
      var aa=(arc/8)*Math.PI*2+eyeT*2.5;
      var flickr=Math.abs(Math.sin(eyeT*6+arc*2.1));
      if(flickr>0.7){
        ex.beginPath();
        ex.moveTo(pCx+Math.cos(aa)*pupilArea,pCy+Math.sin(aa)*pupilArea);
        ex.lineTo(pCx+Math.cos(aa+0.08)*(pupilArea*1.6+Math.sin(eyeT*9+arc)*4),pCy+Math.sin(aa+0.08)*(pupilArea*1.6+Math.sin(eyeT*9+arc)*4));
        ex.strokeStyle='rgba(100,170,230,'+(0.12*eyeOpen*flickr)+')';
        ex.lineWidth=0.5;ex.shadowColor='rgba(80,150,220,0.4)';ex.shadowBlur=3;
        ex.stroke();ex.shadowBlur=0;
      }
    }
    
    ex.restore();
    
    // Eyelid edge — skin tone with subtle supernatural glow
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.55,cy-eyeH*1.45,cx+eyeW*0.55,cy-eyeH*1.45,cx+eyeW,cy);
    ex.bezierCurveTo(cx+eyeW*0.55,cy+eyeH*1.1,cx-eyeW*0.55,cy+eyeH*1.1,cx-eyeW,cy);
    ex.closePath();
    ex.strokeStyle='rgba(80,55,35,'+(0.5+eyeOpen*0.3)+')';
    ex.lineWidth=2+eyeOpen*2;
    ex.shadowColor='rgba(201,169,78,'+(0.2*eyeOpen)+')';
    ex.shadowBlur=15+eyeOpen*20;
    ex.stroke();
    ex.strokeStyle='rgba(30,20,10,'+(0.6*eyeOpen)+')';
    ex.lineWidth=1;
    ex.shadowColor='rgba(0,0,0,'+(0.3*eyeOpen)+')';
    ex.shadowBlur=6;
    ex.stroke();
    ex.shadowBlur=0;
  }
  
  // Closed slit — with breathing pulse
  if(eyeOpen<0.7){
    var la=1-eyeOpen/0.7;
    // Breathing glow — pulses like something alive behind the lid
    var bGlow=0.15+Math.sin(breathPhase)*0.12;
    var bWidth=1.5+Math.sin(breathPhase)*0.8;
    
    // Subtle glow behind closed lid
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.5,cy-eyeW*0.02*la,cx+eyeW*0.5,cy-eyeW*0.02*la,cx+eyeW,cy);
    ex.strokeStyle='rgba(100,170,255,'+(bGlow*0.3*la)+')';
    ex.lineWidth=8+Math.sin(breathPhase)*4;
    ex.shadowColor='rgba(80,140,255,'+(bGlow*0.5*la)+')';
    ex.shadowBlur=30+Math.sin(breathPhase)*15;
    ex.stroke();
    ex.shadowBlur=0;
    
    // Main slit line
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.5,cy-eyeW*0.02*la,cx+eyeW*0.5,cy-eyeW*0.02*la,cx+eyeW,cy);
    ex.strokeStyle='rgba(201,169,78,'+(0.4*la+bGlow*0.15)+')';
    ex.lineWidth=2.5+bWidth*0.3;
    ex.shadowColor='rgba(140,210,255,'+(0.35*la)+')';
    ex.shadowBlur=25;
    ex.stroke();
    ex.shadowBlur=0;
    
    // Tiny pupil glow peeking through slit — follows cursor even when closed
    if(eyeOpen<0.15){
      var peekAlpha=(0.15-eyeOpen)/0.15*la;
      var peekX=cx+pupilX*eyeW*0.15;
      ex.beginPath();ex.arc(peekX,cy,3+Math.sin(breathPhase)*1.5,0,Math.PI*2);
      ex.fillStyle='rgba(130,200,255,'+(peekAlpha*bGlow*2)+')';
      ex.shadowColor='rgba(100,180,255,'+(peekAlpha*0.5)+')';
      ex.shadowBlur=12;
      ex.fill();ex.shadowBlur=0;
    }
  }
  
  requestAnimationFrame(drawEye);
}
drawEye();

// Hover detection — mouse AND touch
var gateEl=document.getElementById('gate');
gateEl.addEventListener('mouseenter',function(){if(!eyeClicked)eyeTarget=0.85});
gateEl.addEventListener('mouseleave',function(){if(!eyeClicked)eyeTarget=0});
// Mobile: eye opens on first touch, stays open
gateEl.addEventListener('touchstart',function(e){
  if(!eyeClicked){
    if(eyeTarget<0.5){
      eyeTarget=0.85;// first tap opens
      e.preventDefault();// don't trigger click yet
    }
    // second tap (eye already open) will fall through to onclick
  }
},{passive:false});

// ═══ FIRE RING ═══
var fc=document.getElementById('fireRing'),fx2=fc.getContext('2d');
fc.width=window.innerWidth*dpr;fc.height=window.innerHeight*dpr;
fc.style.width=window.innerWidth+'px';fc.style.height=window.innerHeight+'px';
fx2.scale(dpr,dpr);
var fireActive=false,fireRadius=0,fireTargetR=0,fireT=0;
var sparks=[];
for(var i=0;i<300;i++){sparks.push({angle:Math.random()*Math.PI*2,speed:0.5+Math.random()*2.5,dist:0.92+Math.random()*0.16,size:1+Math.random()*3.5,life:Math.random(),hue:Math.floor(Math.random()*60)+15,drift:(Math.random()-0.5)*0.3})}
var ringChars='ΩΔΨΦΛΣΘΑΒΓΕΖΗΙΚΜΝΞΟΠΡΤΥΧωδψφλσθ'.split('');

function drawFire(){
  fx2.clearRect(0,0,window.innerWidth,window.innerHeight);
  if(!fireActive||fireRadius<3){
    fireRadius+=(fireTargetR-fireRadius)*0.04;
    requestAnimationFrame(drawFire);return;
  }
  var cx=window.innerWidth/2,cy=window.innerHeight/2;
  fireRadius+=(fireTargetR-fireRadius)*0.03;
  fireT+=0.03;
  
  // 6 glowing rings
  for(var r=0;r<6;r++){
    var rr=fireRadius-r*2.5;if(rr<1)continue;
    fx2.beginPath();fx2.arc(cx,cy,rr,0,Math.PI*2);
    fx2.strokeStyle='rgba(255,'+(170-r*15)+','+(40+r*8)+','+(0.2-r*0.025)+')';
    fx2.lineWidth=10-r*1.5;fx2.shadowColor='rgba(255,140,30,0.5)';fx2.shadowBlur=35-r*4;fx2.stroke();fx2.shadowBlur=0;
  }
  // White hot edge
  fx2.beginPath();fx2.arc(cx,cy,fireRadius,0,Math.PI*2);
  fx2.strokeStyle='rgba(255,230,170,0.4)';fx2.lineWidth=3;fx2.shadowColor='rgba(255,210,120,0.8)';fx2.shadowBlur=30;fx2.stroke();fx2.shadowBlur=0;
  
  // Orbiting runes
  for(var i=0;i<48;i++){
    var a=(i/48)*Math.PI*2+fireT*0.6;
    fx2.save();fx2.translate(cx+Math.cos(a)*fireRadius,cy+Math.sin(a)*fireRadius);fx2.rotate(a+Math.PI/2);
    fx2.font='bold 10px monospace';fx2.fillStyle='rgba(255,210,90,'+(0.4+Math.sin(fireT*3+i)*0.4)+')';
    fx2.shadowColor='rgba(255,160,30,0.9)';fx2.shadowBlur=12;fx2.textAlign='center';fx2.fillText(ringChars[i%ringChars.length],0,0);fx2.restore();
  }
  // Sparks
  for(var i=0;i<sparks.length;i++){
    var s=sparks[i];s.angle+=s.speed*0.02;s.life-=0.003;s.dist+=s.drift*0.001;
    if(s.life<=0){s.angle=Math.random()*Math.PI*2;s.life=0.5+Math.random()*0.5;s.dist=0.92+Math.random()*0.16}
    var sx=cx+Math.cos(s.angle)*fireRadius*s.dist,sy=cy+Math.sin(s.angle)*fireRadius*s.dist;
    fx2.beginPath();fx2.arc(sx+Math.sin(fireT*5+i)*4,sy-s.size*3*s.life,s.size*s.life,0,Math.PI*2);
    fx2.fillStyle='hsla('+s.hue+',100%,'+(50+s.life*30)+'%,'+(s.life*0.9)+')';fx2.shadowColor='hsla('+s.hue+',100%,60%,0.6)';fx2.shadowBlur=10;fx2.fill();fx2.shadowBlur=0;
  }
  // Flares
  if(Math.random()<0.15){var fa=Math.random()*Math.PI*2;fx2.beginPath();fx2.arc(cx+Math.cos(fa)*fireRadius,cy+Math.sin(fa)*fireRadius,3+Math.random()*6,0,Math.PI*2);fx2.fillStyle='rgba(255,245,210,0.7)';fx2.shadowColor='rgba(255,220,120,1)';fx2.shadowBlur=30;fx2.fill();fx2.shadowBlur=0}
  
  requestAnimationFrame(drawFire);
}
drawFire();

// ═══ RESIZE ═══
window.addEventListener('resize',function(){
  dpr=window.devicePixelRatio||1;
  var W=window.innerWidth,H=window.innerHeight;
  mc.width=kc.width=fc.width=W*dpr;mc.height=kc.height=fc.height=H*dpr;
  mc.style.width=kc.style.width=fc.style.width=W+'px';
  mc.style.height=kc.style.height=fc.style.height=H+'px';
  mx.scale(dpr,dpr);kx.scale(dpr,dpr);fx2.scale(dpr,dpr);
  cols=Math.floor(W/(fontSize*0.5));drops=[];colWords=[];colCharIdx=[];
  for(var i=0;i<cols;i++){drops[i]=Math.random()*-100;colWords[i]=Math.random()<0.4?words[Math.floor(Math.random()*words.length)]:'';colCharIdx[i]=0}
  resizeEye();
});

// ═══ PORTAL CONTROLS ═══
function openThreshold(){
  eyeClicked=true;
  eyeTarget=1;// fully open the eye
  
  // After eye opens, start fire ring
  setTimeout(function(){
    fireActive=true;
    var targetSize=Math.min(window.innerWidth,window.innerHeight)*0.44;
    if(targetSize>340)targetSize=340;
    fireTargetR=targetSize;
  },400);
  
  var g=document.getElementById('gate'),p=document.getElementById('portal'),
      vr=document.getElementById('vr'),pc=document.getElementById('pc');
  
  setTimeout(function(){g.classList.add('gate-opening')},800);
  setTimeout(function(){
    p.style.display='flex';
    setTimeout(function(){p.style.background='rgba(0,0,0,0.8)'},50);
  },1200);
  setTimeout(function(){
    vr.style.width='90vmin';vr.style.height='90vmin';
    vr.style.maxWidth='680px';vr.style.maxHeight='680px';
  },1400);
  setTimeout(function(){pc.classList.add('vis')},2200);
  setTimeout(function(){g.style.display='none'},2500);
}

function closeThreshold(){
  var g=document.getElementById('gate'),p=document.getElementById('portal'),
      vr=document.getElementById('vr'),pc=document.getElementById('pc');
  pc.classList.remove('vis');
  fireTargetR=0;
  setTimeout(function(){vr.style.width='0';vr.style.height='0'},300);
  setTimeout(function(){p.style.background='rgba(0,0,0,0)'},1000);
  setTimeout(function(){
    p.style.display='none';fireActive=false;fireRadius=0;
    eyeClicked=false;eyeTarget=0;
    g.style.display='flex';g.classList.remove('gate-opening');
  },1400);
}

// Parallax on eye
gateEl.addEventListener('mousemove',function(e){
  var r=this.getBoundingClientRect(),x=(e.clientX-r.left)/r.width-.5,y=(e.clientY-r.top)/r.height-.5;
  document.getElementById('eye-container').style.transform='translate('+x*20+'px,'+y*15+'px)';
});
</script>
</body>
</html>
