<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<title>LIMEN Helix – The Threshold v3</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;overflow:hidden;height:100vh;width:100vw;font-family:Georgia,serif}
#matrix{position:fixed;inset:0;z-index:1}
#kaleidoscope{position:fixed;inset:0;z-index:2}
#fireRing{position:fixed;inset:0;z-index:12;pointer-events:none}

/* Gate */
#gate{position:fixed;inset:0;z-index:10;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer}
#gate::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at center,transparent 20%,rgba(0,0,0,0.25) 55%,rgba(0,0,0,0.65) 100%);pointer-events:none;z-index:1}

/* Corner glyphs */
.cg{position:absolute;font-size:1.4rem;color:rgba(201,169,78,0.3);letter-spacing:4px;z-index:3;animation:gb 5s ease-in-out infinite;text-shadow:0 0 15px rgba(201,169,78,0.2)}
.cg.tl{top:1.5rem;left:1.5rem}.cg.tr{top:1.5rem;right:1.5rem;animation-delay:1.2s}.cg.bl{bottom:1.5rem;left:1.5rem;animation-delay:2.5s}.cg.br{bottom:1.5rem;right:1.5rem;animation-delay:3.7s}
@keyframes gb{0%,100%{opacity:.3;text-shadow:0 0 15px rgba(201,169,78,0.2)}50%{opacity:.8;text-shadow:0 0 30px rgba(201,169,78,0.5)}}

/* THE EYE */
#eye-container{position:relative;z-index:3;width:75vmin;max-width:650px;height:38vmin;max-height:325px}
#eyeCanvas{width:100%;height:100%}

/* Text below eye */
#gt{text-align:center;z-index:3;margin-top:2.5rem;background:radial-gradient(ellipse at center,rgba(0,0,0,0.85) 0%,rgba(0,0,0,0.6) 60%,transparent 100%);padding:1.5rem 3rem;border-radius:8px}
#gt1{font-size:.7rem;letter-spacing:12px;color:rgba(201,169,78,0.7);text-transform:uppercase;font-family:monospace;margin-bottom:.6rem;text-shadow:0 0 25px rgba(201,169,78,0.4)}
#gt2{font-size:.85rem;color:rgba(201,169,78,0.3);letter-spacing:4px;font-style:italic;text-shadow:0 0 15px rgba(201,169,78,0.2)}
#gt3{font-size:.55rem;letter-spacing:5px;color:rgba(255,80,60,0.4);text-transform:uppercase;font-family:monospace;margin-top:1.2rem;font-weight:bold;animation:warn 3s ease-in-out infinite;text-shadow:0 0 10px rgba(255,40,20,0.3)}
@keyframes warn{0%,100%{opacity:.4;text-shadow:0 0 10px rgba(255,40,20,0.3)}50%{opacity:.9;text-shadow:0 0 25px rgba(255,40,20,0.6)}}
#gate:hover #gt1{color:rgba(201,169,78,1);text-shadow:0 0 35px rgba(201,169,78,0.6)}
#gate:hover #gt2{color:rgba(201,169,78,0.5)}
#gate:hover #gt3{color:rgba(255,80,60,0.6)}
#gate:hover .cg{color:rgba(201,169,78,0.5)}

/* Portal */
#portal{position:fixed;inset:0;z-index:200;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0);transition:background 1.5s ease}
#portal *{position:relative;z-index:1}
#vr{width:0;height:0;border-radius:50%;background:radial-gradient(ellipse at center,rgba(8,5,18,0.97) 0%,rgba(2,1,5,0.99) 100%);transition:all 2s cubic-bezier(0.16,1,0.3,1);display:flex;align-items:center;justify-content:center;overflow:visible;position:relative}
#pc{opacity:0;transform:scale(0.85);transition:all 1s ease;text-align:center;padding:1.5rem;width:100%;max-width:500px}
#pc.vis{opacity:1;transform:scale(1)}
.ctp{font-size:.45rem;letter-spacing:8px;color:#C9A94E;text-transform:uppercase;font-family:monospace;margin-bottom:.5rem}
.ctt{font-size:1.9rem;color:#f8eacb;font-weight:300;margin-bottom:.3rem}
.cts{font-size:1rem;color:#888;line-height:1.9;margin-bottom:1.8rem;font-style:italic;font-weight:600;text-shadow:0 0 10px rgba(201,169,78,0.15)}
.og{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:1.2rem}
.oc{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:22px 14px;border:1px solid rgba(201,169,78,0.15);background:rgba(201,169,78,0.02);text-decoration:none;cursor:pointer;transition:all .4s;overflow:hidden;border-radius:3px}
.oc:hover{border-color:rgba(201,169,78,0.5);background:rgba(201,169,78,0.08);box-shadow:0 0 40px rgba(201,169,78,0.08)}
.oi{font-size:1.8rem;margin-bottom:8px;display:block}.on{font-size:.6rem;letter-spacing:4px;color:#C9A94E;text-transform:uppercase;display:block}.od{font-size:.5rem;color:#555;margin-top:5px;letter-spacing:1px;display:block}
.pb{display:inline-block;background:none;border:1px solid rgba(201,169,78,0.12);color:#444;padding:10px 28px;font-size:.55rem;letter-spacing:3px;cursor:pointer;text-transform:uppercase;font-family:monospace;transition:all .3s;text-decoration:none;margin-top:1rem}
.pb:hover{color:#C9A94E;border-color:rgba(201,169,78,0.35)}
.gate-opening{opacity:0!important;transition:opacity 1.2s!important}
@media(max-width:600px){#eye-container{width:90vmin;height:45vmin}.cg{font-size:1rem}#gt1{font-size:.5rem;letter-spacing:8px}#gt2{font-size:.6rem}#gt3{font-size:.4rem;letter-spacing:3px}#gt{padding:1rem 1.5rem}.ctt{font-size:1.5rem}.og{gap:6px}.oc{padding:16px 10px}}
</style>
</head>
<body>
<canvas id="matrix"></canvas>
<canvas id="kaleidoscope"></canvas>
<canvas id="fireRing"></canvas>

<div id="gate" onclick="openThreshold()">
  <span class="cg tl">Ω · Α</span><span class="cg tr">Δ · Σ</span>
  <span class="cg bl">Ψ · Θ</span><span class="cg br">Φ · Λ</span>
  <div id="eye-container"><canvas id="eyeCanvas"></canvas></div>
  <div id="gt">
    <div id="gt1">Enter the Threshold</div>
    <div id="gt2">seek what lies beyond the pattern</div>
    <div id="gt3">⚠ THE TRUTH LIVES BEYOND THIS POINT · THERE IS NO GOING BACK ⚠</div>
  </div>
</div>

<div id="portal">
  <div id="vr">
    <div id="pc">
      <p class="ctp">You have crossed the limen</p>
      <h1 class="ctt">The Inner Chamber</h1>
      <p class="cts">What you offer here feeds the pattern.<br>What returns to you is the architecture of your own becoming.</p>
      <div class="og">
        <a href="https://chapel-pos-v2.vercel.app" target="_blank" rel="noopener" class="oc" onclick="event.stopPropagation()"><span class="oi">✦</span><span class="on">Offering</span><span class="od">Donation · Tithe</span></a>
        <a href="https://chapel-pos-v2.vercel.app" target="_blank" rel="noopener" class="oc" onclick="event.stopPropagation()"><span class="oi">⬡</span><span class="on">Workshop</span><span class="od">Sessions · Training</span></a>
        <a href="https://chapel-pos-v2.vercel.app" target="_blank" rel="noopener" class="oc" onclick="event.stopPropagation()"><span class="oi">⊕</span><span class="on">Consultation</span><span class="od">1-on-1 · Guidance</span></a>
        <a href="https://chapel-pos-v2.vercel.app" target="_blank" rel="noopener" class="oc" onclick="event.stopPropagation()"><span class="oi">◇</span><span class="on">Materials</span><span class="od">Texts · Resources</span></a>
      </div>
      <button class="pb" onclick="closeThreshold()">← Return to Gate</button>
      <p style="font-size:.35rem;color:rgba(201,169,78,0.06);margin-top:1.2rem;letter-spacing:4px;text-transform:uppercase">Chapel of the LIMEN Helix · 501(c)(3) · EIN 33-4945631</p>
    </div>
  </div>
</div>

<script>
// ═══ GREEK WORDS ═══
var words=['ΛΙΜΕΝ','ΕΛΙΞ','ΦΑΣΙΣ','ΚΑΤΩΦΛΙ','ΣΠΕΙΡΑ','ΕΠΙΣΤΡΟΦΗ','ΜΕΤΑΜΟΡΦΩΣΗ','ΑΝΑΓΕΝΝΗΣΗ','ΦΑΣΗ ΜΗΔΕΝ','ΠΗΓΗ','ΔΙΑΛΥΣΗ','ΑΝΑΔΥΣΗ','ΣΤΑΘΕΡΟΤΗΤΑ','ΕΝΣΩΜΑΤΩΣΗ','ΥΠΕΡΒΑΣΗ','ΚΥΚΛΟΣ','ΜΟΤΙΒΟ','ΤΕΛΕΤΟΥΡΓΙΑ','ΜΥΗΣΗ','ΑΠΟΚΑΛΥΨΗ','ΘΕΟΣ','ΛΟΓΟΣ','ΠΝΕΥΜΑ','ΑΓΑΠΗ','ΔΗΜΙΟΥΡΓΟΣ','ΑΙΩΝΙΟΣ','ΦΩΤΕΙΝΟΣ','ΑΓΙΟΣ','ΘΕΙΑ ΤΑΞΗ','ΟΥΡΑΝΟΣ','ΑΛΗΘΕΙΑ','ΣΟΦΙΑ','ΑΡΜΟΝΙΑ','ΑΝΑΛΗΨΗ','ΧΑΡΙΣ','ΕΛΕΟΣ','ΛΥΤΡΩΣΗ','ΑΝΑΣΤΑΣΙΣ','ΣΑΤΑΝ','ΕΩΣΦΟΡΟΣ','ΣΚΟΤΟΣ','ΠΤΩΣΗ','ΔΑΙΜΩΝ','ΠΕΙΡΑΣΜΟΣ','ΣΚΙΑ','ΑΒΥΣΣΟΣ','ΧΑΟΣ','ΑΠΟΣΤΑΣΙΑ','ΠΛΑΝΗ','ΟΦΙΣ','ΑΠΟΚΡΥΦΑ','ΓΝΩΣΗ','ΜΥΣΤΗΡΙΟ','ΣΥΝΩΜΟΣΙΑ','ΕΛΕΓΧΟΣ','ΤΡΙΤΟ ΜΑΤΙ','ΠΥΡΑΜΙΔΑ','ΑΦΥΠΝΙΣΗ','ΚΟΚΚΙΝΟ ΧΑΠΙ','ΜΗΤΡΑ','ΝΕΥΡΩΝΑΣ','ΣΥΝΑΨΗ','ΕΓΚΕΦΑΛΟΣ','ΑΜΥΓΔΑΛΗ','ΙΠΠΟΚΑΜΠΟΣ','ΝΕΥΡΙΚΟ ΣΥΣΤΗΜΑ','ΝΕΥΡΟΠΛΑΣΤΙΚΟΤΗΤΑ','ΝΤΟΠΑΜΙΝΗ','ΣΕΡΟΤΟΝΙΝΗ','ΚΟΡΤΙΖΟΛΗ','ΑΔΡΕΝΑΛΙΝΗ','ΩΚΥΤΟΚΙΝΗ','ΟΜΟΙΟΣΤΑΣΙΣ','ΕΝΤΡΟΠΙΑ','ΕΝΕΡΓΕΙΑ','ΣΥΧΝΟΤΗΤΑ','ΔΟΝΗΣΗ','ΚΒΑΝΤΙΚΟ','ΦΡΑΚΤΑΛ','ΧΡΥΣΗ ΤΟΜΗ','ΙΕΡΑ ΓΕΩΜΕΤΡΙΑ','ΚΟΥΝΤΑΛΙΝΙ','ΤΣΑΚΡΑ'];
var greekChars='ΩΔΨΦΛΣΘΑΒΓΕΖΗΙΚΜΝΞΟΠΡΤΥΧωδψφλσθαβγεζηικμνξοπρτυχ∞∑∏∫√∂'.split('');

// ═══ MATRIX RAIN ═══
// ═══ CANVAS DPI FIX ═══
var dpr=window.devicePixelRatio||1;

var mc=document.getElementById('matrix'),mx=mc.getContext('2d');
mc.width=window.innerWidth*dpr;mc.height=window.innerHeight*dpr;
mc.style.width=window.innerWidth+'px';mc.style.height=window.innerHeight+'px';
mx.scale(dpr,dpr);
var fontSize=12,cols=Math.floor(window.innerWidth/(fontSize*0.5));
var drops=[],colWords=[],colCharIdx=[];
for(var i=0;i<cols;i++){drops[i]=Math.random()*-100;colWords[i]=Math.random()<0.4?words[Math.floor(Math.random()*words.length)]:'';colCharIdx[i]=0}

function drawMatrix(){
  mx.fillStyle='rgba(0,0,0,0.035)';
  mx.fillRect(0,0,window.innerWidth,window.innerHeight);
  for(var i=0;i<drops.length;i++){
    var ch;
    if(colWords[i]&&colCharIdx[i]<colWords[i].length){ch=colWords[i][colCharIdx[i]];colCharIdx[i]++}
    else{ch=greekChars[Math.floor(Math.random()*greekChars.length)];if(Math.random()<0.02){colWords[i]=words[Math.floor(Math.random()*words.length)];colCharIdx[i]=0}}
    var x=i*(fontSize*0.5),y=drops[i]*fontSize,c=Math.random();
    if(c<0.35){mx.fillStyle='rgba(201,169,78,'+(0.6+Math.random()*0.4)+')';mx.shadowColor='rgba(201,169,78,0.7)'}
    else if(c<0.55){mx.fillStyle='rgba(160,100,255,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(160,100,255,0.6)'}
    else if(c<0.7){mx.fillStyle='rgba(80,180,255,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(80,180,255,0.6)'}
    else if(c<0.85){mx.fillStyle='rgba(255,80,180,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(255,80,180,0.6)'}
    else{mx.fillStyle='rgba(255,160,40,'+(0.5+Math.random()*0.5)+')';mx.shadowColor='rgba(255,160,40,0.6)'}
    mx.shadowBlur=8+Math.random()*8;mx.font=(fontSize-2+Math.random()*4)+'px monospace';mx.fillText(ch,x,y);mx.shadowBlur=0;
    if(y>window.innerHeight&&Math.random()>0.98){drops[i]=0;colWords[i]=Math.random()<0.4?words[Math.floor(Math.random()*words.length)]:'';colCharIdx[i]=0}
    drops[i]+=0.25+Math.random()*0.35;
  }
  requestAnimationFrame(drawMatrix);
}
drawMatrix();

// ═══ KALEIDOSCOPE ═══
var kc=document.getElementById('kaleidoscope'),kx=kc.getContext('2d');
kc.width=window.innerWidth*dpr;kc.height=window.innerHeight*dpr;
kc.style.width=window.innerWidth+'px';kc.style.height=window.innerHeight+'px';
kx.scale(dpr,dpr);
var t=0;
function drawK(){
  kx.clearRect(0,0,window.innerWidth,window.innerHeight);
  var cx=window.innerWidth/2,cy=window.innerHeight/2,maxR=Math.min(window.innerWidth,window.innerHeight)*0.48;
  for(var arm=0;arm<12;arm++){
    var ba=(arm/12)*Math.PI*2+t*0.15;kx.beginPath();
    for(var i=0;i<300;i++){var r=i/300,a=ba+r*Math.PI*6+Math.sin(t*0.3+r*4)*0.8,rr=r*maxR,w=Math.sin(t*2+r*10+arm)*rr*0.02;
    var px=cx+Math.cos(a)*(rr+w),py=cy+Math.sin(a)*(rr+w);if(i===0)kx.moveTo(px,py);else kx.lineTo(px,py)}
    kx.strokeStyle='hsla('+((arm*30+t*25)%360)+',80%,60%,'+(0.04+Math.sin(t*0.5+arm)*0.02)+')';kx.lineWidth=1.2;kx.stroke();
  }
  for(var l=0;l<8;l++){
    var lr=maxR*(0.1+l*0.11),s=3+l,rot=t*(l%2===0?0.2:-0.2)+l*0.4;kx.beginPath();
    for(var si=0;si<=s;si++){var a=(si/s)*Math.PI*2+rot,p=Math.sin(t*1.5+l+si)*lr*0.04;
    var px=cx+Math.cos(a)*(lr+p),py=cy+Math.sin(a)*(lr+p);if(si===0)kx.moveTo(px,py);else kx.lineTo(px,py)}
    kx.closePath();kx.strokeStyle='hsla('+((l*45+t*20+120)%360)+',70%,55%,'+(0.06+Math.sin(t+l)*0.03)+')';kx.lineWidth=1+l*0.15;kx.stroke();
  }
  t+=0.012;requestAnimationFrame(drawK);
}
drawK();

// ═══ THE EYE — canvas drawn, reacts to hover ═══
var ec=document.getElementById('eyeCanvas'),ex=ec.getContext('2d');
var eyeOpen=0;// 0=closed, 1=fully open
var eyeTarget=0;
var eyeT=0;
var eyeClicked=false;

function resizeEye(){
  var cont=document.getElementById('eye-container');
  ec.width=cont.offsetWidth*2;ec.height=cont.offsetHeight*2;// 2x for retina
}
resizeEye();

function drawEye(){
  var w=ec.width,h=ec.height,cx=w/2,cy=h/2;
  ex.clearRect(0,0,w,h);
  eyeOpen+=(eyeTarget-eyeOpen)*0.05;
  eyeT+=0.015;
  
  var eyeW=w*0.45;
  var eyeH=h*0.42*eyeOpen;
  
  // ALL-SEEING EYE RAYS — visible even when closed, radiating from behind
  if(eyeOpen>0.01||true){
    var rayAlpha=0.02+eyeOpen*0.06;
    for(var r=0;r<60;r++){
      var a=(r/60)*Math.PI*2+eyeT*0.08+Math.sin(r*0.5)*0.1;
      var rLen=Math.max(w,h)*(0.3+Math.sin(eyeT+r*1.1)*0.15);
      ex.beginPath();ex.moveTo(cx,cy);
      ex.lineTo(cx+Math.cos(a)*rLen,cy+Math.sin(a)*rLen);
      var rc=r%5;
      if(rc===0)ex.strokeStyle='rgba(201,169,78,'+rayAlpha+')';
      else if(rc===1)ex.strokeStyle='rgba(140,200,255,'+rayAlpha*0.7+')';
      else if(rc===2)ex.strokeStyle='rgba(255,255,255,'+rayAlpha*0.5+')';
      else if(rc===3)ex.strokeStyle='rgba(200,140,255,'+rayAlpha*0.6+')';
      else ex.strokeStyle='rgba(255,200,130,'+rayAlpha*0.8+')';
      ex.lineWidth=0.5+Math.sin(eyeT*2+r)*0.5;
      ex.stroke();
    }
  }
  
  if(eyeOpen>0.03){
    // Clip to eye shape
    ex.save();
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.55,cy-eyeH*1.1,cx+eyeW*0.55,cy-eyeH*1.1,cx+eyeW,cy);
    ex.bezierCurveTo(cx+eyeW*0.55,cy+eyeH*1.1,cx-eyeW*0.55,cy+eyeH*1.1,cx-eyeW,cy);
    ex.closePath();
    ex.clip();
    
    var maxR=Math.max(eyeW,eyeH)*1.4;
    
    // LAYER 1: Cosmic nebula base
    var baseGrad=ex.createRadialGradient(cx,cy,0,cx,cy,maxR);
    baseGrad.addColorStop(0,'rgba(255,255,255,'+(1.0*eyeOpen)+')');
    baseGrad.addColorStop(0.03,'rgba(220,240,255,'+(0.97*eyeOpen)+')');
    baseGrad.addColorStop(0.08,'rgba(140,210,255,'+(0.9*eyeOpen)+')');
    baseGrad.addColorStop(0.18,'rgba(80,140,255,'+(0.75*eyeOpen)+')');
    baseGrad.addColorStop(0.3,'rgba(180,100,220,'+(0.5*eyeOpen)+')');
    baseGrad.addColorStop(0.45,'rgba(220,160,60,'+(0.35*eyeOpen)+')');
    baseGrad.addColorStop(0.6,'rgba(180,40,80,'+(0.2*eyeOpen)+')');
    baseGrad.addColorStop(0.8,'rgba(40,15,80,'+(0.15*eyeOpen)+')');
    baseGrad.addColorStop(1,'rgba(5,2,15,'+(0.05*eyeOpen)+')');
    ex.fillStyle=baseGrad;
    ex.fillRect(0,0,w,h);
    
    // LAYER 2: Asymmetric nebula clouds
    for(var neb=0;neb<6;neb++){
      var nx=cx+Math.sin(neb*2.1+eyeT*0.3)*maxR*0.4;
      var ny=cy+Math.cos(neb*1.7+eyeT*0.2)*maxR*0.3;
      var nr=maxR*(0.15+neb*0.06);
      var nebGrad=ex.createRadialGradient(nx,ny,0,nx,ny,nr);
      var nebColors=[
        ['rgba(100,180,255,','rgba(60,120,200,'],
        ['rgba(200,130,255,','rgba(140,60,180,'],
        ['rgba(255,180,120,','rgba(200,120,60,'],
        ['rgba(120,255,200,','rgba(60,180,140,'],
        ['rgba(255,130,180,','rgba(200,80,130,'],
        ['rgba(180,220,255,','rgba(120,160,200,']
      ][neb];
      nebGrad.addColorStop(0,nebColors[0]+(0.12*eyeOpen)+')');
      nebGrad.addColorStop(0.5,nebColors[1]+(0.06*eyeOpen)+')');
      nebGrad.addColorStop(1,'rgba(0,0,0,0)');
      ex.fillStyle=nebGrad;
      ex.fillRect(0,0,w,h);
    }
    
    // LAYER 3: 80 crystalline fractal shards — golden angle distribution
    var seed=137.508;
    for(var shard=0;shard<80;shard++){
      var baseA=shard*seed*(Math.PI/180)+eyeT*0.12;
      var shardLen=maxR*(0.1+((shard*17+11)%29)/29*0.7);
      baseA+=Math.sin(shard*2.3+eyeT*0.6)*0.5;
      
      ex.beginPath();
      var pts=[];
      ex.moveTo(cx,cy);
      var segs=3+shard%6;
      for(var seg=0;seg<segs;seg++){
        var ratio=(seg+1)/segs;
        var drift=Math.sin(eyeT*1.2+shard*1.9+seg*3.7)*(25-ratio*20);
        var nx=cx+Math.cos(baseA)*(shardLen*ratio)+Math.cos(baseA+1.57)*drift;
        var ny=cy+Math.sin(baseA)*(shardLen*ratio)+Math.sin(baseA+1.57)*drift;
        ex.lineTo(nx,ny);
        pts.push({x:nx,y:ny});
      }
      
      var colors=[
        'rgba(180,235,255,','rgba(255,225,140,','rgba(210,150,255,',
        'rgba(255,170,200,','rgba(140,255,220,','rgba(255,255,255,',
        'rgba(100,200,255,','rgba(255,200,100,'
      ];
      var alpha=(0.06+Math.sin(eyeT*1.8+shard*0.7)*0.04)*eyeOpen;
      ex.strokeStyle=colors[(shard*7)%colors.length]+alpha+')';
      ex.lineWidth=0.8+((shard*3)%5)*0.3;
      ex.shadowColor=ex.strokeStyle.replace(alpha+'',Math.min(alpha*4,0.4)+'');
      ex.shadowBlur=6;
      ex.stroke();
      ex.shadowBlur=0;
      
      // Branches
      if(shard%3===0&&pts.length>1){
        var bp=pts[Math.floor(pts.length/2)];
        var brA=baseA+((shard%2===0)?0.7:-0.6)+Math.sin(eyeT+shard)*0.4;
        var brL=shardLen*0.3;
        ex.beginPath();ex.moveTo(bp.x,bp.y);
        ex.lineTo(bp.x+Math.cos(brA)*brL+Math.sin(eyeT*2+shard)*6,bp.y+Math.sin(brA)*brL+Math.cos(eyeT*2+shard)*6);
        ex.strokeStyle='rgba(180,220,255,'+(0.04*eyeOpen)+')';
        ex.lineWidth=0.6;ex.stroke();
      }
      
      // Crystal tip sparks
      if(shard%5===0&&pts.length>0){
        var tip=pts[pts.length-1];
        var tp=Math.abs(Math.sin(eyeT*2.5+shard*1.3));
        ex.beginPath();ex.arc(tip.x,tip.y,1+tp*3,0,Math.PI*2);
        ex.fillStyle='rgba(200,240,255,'+(0.35*eyeOpen*tp)+')';
        ex.shadowColor='rgba(150,220,255,0.8)';ex.shadowBlur=10;
        ex.fill();ex.shadowBlur=0;
      }
    }
    
    // LAYER 4: Electric arcs crackling across
    for(var e=0;e<10;e++){
      var ea=eyeT*1.5+e*seed*2*(Math.PI/180);
      var er=maxR*(0.2+Math.sin(eyeT*0.8+e)*0.2);
      ex.beginPath();
      var ax=cx+Math.cos(ea)*er,ay=cy+Math.sin(ea)*er;
      ex.moveTo(ax,ay);
      for(var zag=0;zag<5;zag++){
        ax+=Math.sin(eyeT*10+e*4+zag*3)*18;
        ay+=Math.cos(eyeT*8+e*3+zag*4)*14;
        ex.lineTo(ax,ay);
      }
      ex.strokeStyle='rgba(100,190,255,'+(0.1*eyeOpen*Math.abs(Math.sin(eyeT*4+e)))+')';
      ex.lineWidth=1.2;ex.shadowColor='rgba(80,170,255,0.7)';ex.shadowBlur=8;
      ex.stroke();ex.shadowBlur=0;
    }
    
    // LAYER 5: 35 floating knowledge particles — multi-color, multi-size
    for(var sp=0;sp<35;sp++){
      var sa=eyeT*0.35+sp*0.251+Math.sin(sp*1.3)*0.8;
      var sr=maxR*(0.06+((sp*13)%30)/30*0.8);
      var sx=cx+Math.cos(sa)*sr+Math.sin(eyeT*1.9+sp*1.1)*15;
      var sy=cy+Math.sin(sa)*sr+Math.cos(eyeT*1.4+sp*0.8)*15;
      var ss=0.4+((sp*7)%6)*0.5+Math.sin(eyeT*2.5+sp)*0.8;
      if(ss>0.3){
        ex.beginPath();ex.arc(sx,sy,ss,0,Math.PI*2);
        var spColors=['rgba(200,240,255,','rgba(255,225,160,','rgba(210,160,255,','rgba(160,255,220,','rgba(255,180,200,'];
        ex.fillStyle=spColors[sp%5]+(0.45*eyeOpen*Math.abs(Math.sin(eyeT*2.5+sp)))+')';
        ex.shadowColor='rgba(180,220,255,0.5)';ex.shadowBlur=5;
        ex.fill();ex.shadowBlur=0;
      }
    }
    
    // LAYER 6: Inner iris golden ring
    var irisR=eyeH*0.5;
    if(irisR>5){
      ex.beginPath();ex.arc(cx,cy,irisR,0,Math.PI*2);
      ex.strokeStyle='rgba(201,169,78,'+(0.15*eyeOpen)+')';
      ex.lineWidth=2;ex.stroke();
      // Iris threads
      for(var i=0;i<30;i++){
        var a=(i/30)*Math.PI*2+eyeT*0.4;
        ex.beginPath();
        ex.moveTo(cx+Math.cos(a)*irisR*0.15,cy+Math.sin(a)*irisR*0.15);
        ex.lineTo(cx+Math.cos(a+Math.sin(eyeT+i)*0.05)*irisR*1.2,cy+Math.sin(a+Math.sin(eyeT+i)*0.05)*irisR*1.2);
        ex.strokeStyle='rgba(201,169,78,'+(0.06*eyeOpen)+')';
        ex.lineWidth=0.8;ex.stroke();
      }
    }
    
    // LAYER 7: PUPIL — the forbidden void
    var pupilR=Math.max(eyeH*0.16,4);
    // Blue corona
    var corona=ex.createRadialGradient(cx,cy,pupilR*0.6,cx,cy,pupilR*2.5);
    corona.addColorStop(0,'rgba(0,0,5,'+(0.97*eyeOpen)+')');
    corona.addColorStop(0.4,'rgba(15,30,60,'+(0.6*eyeOpen)+')');
    corona.addColorStop(0.7,'rgba(50,100,180,'+(0.25*eyeOpen)+')');
    corona.addColorStop(1,'rgba(100,180,255,'+(0.03*eyeOpen)+')');
    ex.beginPath();ex.arc(cx,cy,pupilR*2.5,0,Math.PI*2);
    ex.fillStyle=corona;ex.fill();
    
    // Void
    ex.beginPath();ex.arc(cx,cy,pupilR,0,Math.PI*2);
    ex.fillStyle='rgba(0,0,0,'+(0.99*eyeOpen)+')';ex.fill();
    
    // Micro lightning around pupil
    for(var arc=0;arc<16;arc++){
      var aa=(arc/16)*Math.PI*2+eyeT*2.5;
      var flickr=Math.abs(Math.sin(eyeT*6+arc*2.1));
      if(flickr>0.5){
        ex.beginPath();
        ex.moveTo(cx+Math.cos(aa)*pupilR,cy+Math.sin(aa)*pupilR);
        ex.lineTo(cx+Math.cos(aa+0.1)*(pupilR*1.8+Math.sin(eyeT*9+arc)*6),cy+Math.sin(aa+0.1)*(pupilR*1.8+Math.sin(eyeT*9+arc)*6));
        ex.strokeStyle='rgba(130,200,255,'+(0.4*eyeOpen*flickr)+')';
        ex.lineWidth=0.8;ex.shadowColor='rgba(80,170,255,0.9)';ex.shadowBlur=4;
        ex.stroke();ex.shadowBlur=0;
      }
    }
    
    // Light reflections
    ex.beginPath();ex.arc(cx-pupilR*0.45,cy-pupilR*0.4,pupilR*0.25,0,Math.PI*2);
    ex.fillStyle='rgba(220,240,255,'+(0.65*eyeOpen)+')';ex.fill();
    ex.beginPath();ex.arc(cx+pupilR*0.3,cy+pupilR*0.2,pupilR*0.12,0,Math.PI*2);
    ex.fillStyle='rgba(255,255,255,'+(0.35*eyeOpen)+')';ex.fill();
    
    ex.restore();
    
    // Eye outline — double glow
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.55,cy-eyeH*1.1,cx+eyeW*0.55,cy-eyeH*1.1,cx+eyeW,cy);
    ex.bezierCurveTo(cx+eyeW*0.55,cy+eyeH*1.1,cx-eyeW*0.55,cy+eyeH*1.1,cx-eyeW,cy);
    ex.closePath();
    ex.strokeStyle='rgba(201,169,78,'+(0.5+eyeOpen*0.5)+')';
    ex.lineWidth=2.5+eyeOpen*2;
    ex.shadowColor='rgba(140,210,255,'+(0.7*eyeOpen)+')';
    ex.shadowBlur=50+eyeOpen*60;
    ex.stroke();
    ex.strokeStyle='rgba(255,230,170,'+(0.25*eyeOpen)+')';
    ex.lineWidth=1;
    ex.shadowColor='rgba(255,210,120,'+(0.5*eyeOpen)+')';
    ex.shadowBlur=25;
    ex.stroke();
    ex.shadowBlur=0;
  }
  
  // Closed slit
  if(eyeOpen<0.7){
    var la=1-eyeOpen/0.7;
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.5,cy-eyeW*0.02*la,cx+eyeW*0.5,cy-eyeW*0.02*la,cx+eyeW,cy);
    ex.strokeStyle='rgba(201,169,78,'+(0.55*la)+')';
    ex.lineWidth=2.5;
    ex.shadowColor='rgba(140,210,255,'+(0.35*la)+')';
    ex.shadowBlur=25;
    ex.stroke();
    ex.shadowBlur=0;
  }
  
  requestAnimationFrame(drawEye);
}
    
    // Iris ring detail — golden threads
    var irisR=eyeH*0.55;
    if(irisR>3){
      for(var i=0;i<24;i++){
        var a=(i/24)*Math.PI*2+eyeT*0.5;
        ex.beginPath();
        ex.moveTo(cx+Math.cos(a)*irisR*0.2,cy+Math.sin(a)*irisR*0.2);
        ex.lineTo(cx+Math.cos(a)*irisR*1.4,cy+Math.sin(a)*irisR*1.4);
        ex.strokeStyle='rgba(201,169,78,'+(0.12*eyeOpen)+')';
        ex.lineWidth=1;
        ex.stroke();
      }
    }
    
    // PUPIL — the abyss, the portal into forbidden knowledge
    var pupilR=Math.max(eyeH*0.18,3);
    // Pupil corona — electric blue ring around void
    ex.beginPath();ex.arc(cx,cy,pupilR*2,0,Math.PI*2);
    var coronaGrad=ex.createRadialGradient(cx,cy,pupilR*0.8,cx,cy,pupilR*2.2);
    coronaGrad.addColorStop(0,'rgba(0,0,0,'+(0.95*eyeOpen)+')');
    coronaGrad.addColorStop(0.5,'rgba(20,40,80,'+(0.5*eyeOpen)+')');
    coronaGrad.addColorStop(0.8,'rgba(60,120,200,'+(0.2*eyeOpen)+')');
    coronaGrad.addColorStop(1,'rgba(100,180,255,'+(0.05*eyeOpen)+')');
    ex.fillStyle=coronaGrad;
    ex.fill();
    
    // The void
    ex.beginPath();ex.arc(cx,cy,pupilR,0,Math.PI*2);
    ex.fillStyle='rgba(0,0,0,'+(0.99*eyeOpen)+')';
    ex.fill();
    
    // Tiny electric arcs around pupil edge
    for(var arc=0;arc<12;arc++){
      var aa=(arc/12)*Math.PI*2+eyeT*2;
      ex.beginPath();
      ex.moveTo(cx+Math.cos(aa)*pupilR,cy+Math.sin(aa)*pupilR);
      ex.lineTo(cx+Math.cos(aa+0.15)*(pupilR*1.6+Math.sin(eyeT*8+arc)*5),cy+Math.sin(aa+0.15)*(pupilR*1.6+Math.sin(eyeT*8+arc)*5));
      ex.strokeStyle='rgba(120,200,255,'+(0.3*eyeOpen*Math.abs(Math.sin(eyeT*5+arc)))+')';
      ex.lineWidth=1;
      ex.shadowColor='rgba(80,160,255,0.8)';ex.shadowBlur=5;
      ex.stroke();ex.shadowBlur=0;
    }
    
    // Divine light reflections in pupil
    ex.beginPath();ex.arc(cx-pupilR*0.4,cy-pupilR*0.35,pupilR*0.22,0,Math.PI*2);
    ex.fillStyle='rgba(200,230,255,'+(0.6*eyeOpen)+')';ex.fill();
    ex.beginPath();ex.arc(cx+pupilR*0.25,cy+pupilR*0.15,pupilR*0.1,0,Math.PI*2);
    ex.fillStyle='rgba(255,255,255,'+(0.35*eyeOpen)+')';ex.fill();
    
    ex.restore();// release clip
    
    // Eye outline — bright gold with blue-white glow
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.6,cy-eyeH,cx+eyeW*0.6,cy-eyeH,cx+eyeW,cy);
    ex.bezierCurveTo(cx+eyeW*0.6,cy+eyeH,cx-eyeW*0.6,cy+eyeH,cx-eyeW,cy);
    ex.closePath();
    ex.strokeStyle='rgba(201,169,78,'+(0.5+eyeOpen*0.5)+')';
    ex.lineWidth=2+eyeOpen*2;
    ex.shadowColor='rgba(140,200,255,'+(0.6*eyeOpen)+')';
    ex.shadowBlur=40+eyeOpen*50;
    ex.stroke();
    ex.shadowBlur=0;
    // Second glow pass — gold
    ex.strokeStyle='rgba(255,220,140,'+(0.2*eyeOpen)+')';
    ex.lineWidth=1;
    ex.shadowColor='rgba(255,200,100,'+(0.4*eyeOpen)+')';
    ex.shadowBlur=20;
    ex.stroke();
    ex.shadowBlur=0;
  }
  
  // Closed lid line — just the golden slit
  if(eyeOpen<0.7){
    var lidAlpha=(1-eyeOpen/0.7);
    ex.beginPath();
    ex.moveTo(cx-eyeW,cy);
    ex.bezierCurveTo(cx-eyeW*0.5,cy-eyeW*0.03*lidAlpha,cx+eyeW*0.5,cy-eyeW*0.03*lidAlpha,cx+eyeW,cy);
    ex.strokeStyle='rgba(201,169,78,'+(0.5*lidAlpha)+')';
    ex.lineWidth=2.5;
    ex.shadowColor='rgba(140,200,255,'+(0.3*lidAlpha)+')';
    ex.shadowBlur=25;
    ex.stroke();
    ex.shadowBlur=0;
  }
  
  requestAnimationFrame(drawEye);
}
drawEye();

// Hover detection — mouse AND touch
var gateEl=document.getElementById('gate');
gateEl.addEventListener('mouseenter',function(){if(!eyeClicked)eyeTarget=0.85});
gateEl.addEventListener('mouseleave',function(){if(!eyeClicked)eyeTarget=0});
// Mobile: eye opens on first touch, stays open
gateEl.addEventListener('touchstart',function(e){
  if(!eyeClicked){
    if(eyeTarget<0.5){
      eyeTarget=0.85;// first tap opens
      e.preventDefault();// don't trigger click yet
    }
    // second tap (eye already open) will fall through to onclick
  }
},{passive:false});

// ═══ FIRE RING ═══
var fc=document.getElementById('fireRing'),fx2=fc.getContext('2d');
fc.width=window.innerWidth*dpr;fc.height=window.innerHeight*dpr;
fc.style.width=window.innerWidth+'px';fc.style.height=window.innerHeight+'px';
fx2.scale(dpr,dpr);
var fireActive=false,fireRadius=0,fireTargetR=0,fireT=0;
var sparks=[];
for(var i=0;i<300;i++){sparks.push({angle:Math.random()*Math.PI*2,speed:0.5+Math.random()*2.5,dist:0.92+Math.random()*0.16,size:1+Math.random()*3.5,life:Math.random(),hue:Math.floor(Math.random()*60)+15,drift:(Math.random()-0.5)*0.3})}
var ringChars='ΩΔΨΦΛΣΘΑΒΓΕΖΗΙΚΜΝΞΟΠΡΤΥΧωδψφλσθ'.split('');

function drawFire(){
  fx2.clearRect(0,0,window.innerWidth,window.innerHeight);
  if(!fireActive||fireRadius<3){
    fireRadius+=(fireTargetR-fireRadius)*0.04;
    requestAnimationFrame(drawFire);return;
  }
  var cx=window.innerWidth/2,cy=window.innerHeight/2;
  fireRadius+=(fireTargetR-fireRadius)*0.03;
  fireT+=0.03;
  
  // 6 glowing rings
  for(var r=0;r<6;r++){
    var rr=fireRadius-r*2.5;if(rr<1)continue;
    fx2.beginPath();fx2.arc(cx,cy,rr,0,Math.PI*2);
    fx2.strokeStyle='rgba(255,'+(170-r*15)+','+(40+r*8)+','+(0.2-r*0.025)+')';
    fx2.lineWidth=10-r*1.5;fx2.shadowColor='rgba(255,140,30,0.5)';fx2.shadowBlur=35-r*4;fx2.stroke();fx2.shadowBlur=0;
  }
  // White hot edge
  fx2.beginPath();fx2.arc(cx,cy,fireRadius,0,Math.PI*2);
  fx2.strokeStyle='rgba(255,230,170,0.4)';fx2.lineWidth=3;fx2.shadowColor='rgba(255,210,120,0.8)';fx2.shadowBlur=30;fx2.stroke();fx2.shadowBlur=0;
  
  // Orbiting runes
  for(var i=0;i<48;i++){
    var a=(i/48)*Math.PI*2+fireT*0.6;
    fx2.save();fx2.translate(cx+Math.cos(a)*fireRadius,cy+Math.sin(a)*fireRadius);fx2.rotate(a+Math.PI/2);
    fx2.font='bold 10px monospace';fx2.fillStyle='rgba(255,210,90,'+(0.4+Math.sin(fireT*3+i)*0.4)+')';
    fx2.shadowColor='rgba(255,160,30,0.9)';fx2.shadowBlur=12;fx2.textAlign='center';fx2.fillText(ringChars[i%ringChars.length],0,0);fx2.restore();
  }
  // Sparks
  for(var i=0;i<sparks.length;i++){
    var s=sparks[i];s.angle+=s.speed*0.02;s.life-=0.003;s.dist+=s.drift*0.001;
    if(s.life<=0){s.angle=Math.random()*Math.PI*2;s.life=0.5+Math.random()*0.5;s.dist=0.92+Math.random()*0.16}
    var sx=cx+Math.cos(s.angle)*fireRadius*s.dist,sy=cy+Math.sin(s.angle)*fireRadius*s.dist;
    fx2.beginPath();fx2.arc(sx+Math.sin(fireT*5+i)*4,sy-s.size*3*s.life,s.size*s.life,0,Math.PI*2);
    fx2.fillStyle='hsla('+s.hue+',100%,'+(50+s.life*30)+'%,'+(s.life*0.9)+')';fx2.shadowColor='hsla('+s.hue+',100%,60%,0.6)';fx2.shadowBlur=10;fx2.fill();fx2.shadowBlur=0;
  }
  // Flares
  if(Math.random()<0.15){var fa=Math.random()*Math.PI*2;fx2.beginPath();fx2.arc(cx+Math.cos(fa)*fireRadius,cy+Math.sin(fa)*fireRadius,3+Math.random()*6,0,Math.PI*2);fx2.fillStyle='rgba(255,245,210,0.7)';fx2.shadowColor='rgba(255,220,120,1)';fx2.shadowBlur=30;fx2.fill();fx2.shadowBlur=0}
  
  requestAnimationFrame(drawFire);
}
drawFire();

// ═══ RESIZE ═══
window.addEventListener('resize',function(){
  dpr=window.devicePixelRatio||1;
  var W=window.innerWidth,H=window.innerHeight;
  mc.width=kc.width=fc.width=W*dpr;mc.height=kc.height=fc.height=H*dpr;
  mc.style.width=kc.style.width=fc.style.width=W+'px';
  mc.style.height=kc.style.height=fc.style.height=H+'px';
  mx.scale(dpr,dpr);kx.scale(dpr,dpr);fx2.scale(dpr,dpr);
  cols=Math.floor(W/(fontSize*0.5));drops=[];colWords=[];colCharIdx=[];
  for(var i=0;i<cols;i++){drops[i]=Math.random()*-100;colWords[i]=Math.random()<0.4?words[Math.floor(Math.random()*words.length)]:'';colCharIdx[i]=0}
  resizeEye();
});

// ═══ PORTAL CONTROLS ═══
function openThreshold(){
  eyeClicked=true;
  eyeTarget=1;// fully open the eye
  
  // After eye opens, start fire ring
  setTimeout(function(){
    fireActive=true;
    var targetSize=Math.min(window.innerWidth,window.innerHeight)*0.44;
    if(targetSize>340)targetSize=340;
    fireTargetR=targetSize;
  },400);
  
  var g=document.getElementById('gate'),p=document.getElementById('portal'),
      vr=document.getElementById('vr'),pc=document.getElementById('pc');
  
  setTimeout(function(){g.classList.add('gate-opening')},800);
  setTimeout(function(){
    p.style.display='flex';
    setTimeout(function(){p.style.background='rgba(0,0,0,0.8)'},50);
  },1200);
  setTimeout(function(){
    vr.style.width='90vmin';vr.style.height='90vmin';
    vr.style.maxWidth='680px';vr.style.maxHeight='680px';
  },1400);
  setTimeout(function(){pc.classList.add('vis')},2200);
  setTimeout(function(){g.style.display='none'},2500);
}

function closeThreshold(){
  var g=document.getElementById('gate'),p=document.getElementById('portal'),
      vr=document.getElementById('vr'),pc=document.getElementById('pc');
  pc.classList.remove('vis');
  fireTargetR=0;
  setTimeout(function(){vr.style.width='0';vr.style.height='0'},300);
  setTimeout(function(){p.style.background='rgba(0,0,0,0)'},1000);
  setTimeout(function(){
    p.style.display='none';fireActive=false;fireRadius=0;
    eyeClicked=false;eyeTarget=0;
    g.style.display='flex';g.classList.remove('gate-opening');
  },1400);
}

// Parallax on eye
gateEl.addEventListener('mousemove',function(e){
  var r=this.getBoundingClientRect(),x=(e.clientX-r.left)/r.width-.5,y=(e.clientY-r.top)/r.height-.5;
  document.getElementById('eye-container').style.transform='translate('+x*20+'px,'+y*15+'px)';
});
</script>
</body>
</html>
