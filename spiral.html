<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>LIMEN HELIX</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{background:#000;color:#e8e3d9;font-family:monospace;overflow:hidden;height:100%;width:100%;-webkit-user-select:none;user-select:none}
canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0}

/* HUD - minimal Jarvis-style readouts */
.hud-top{position:fixed;top:12px;left:0;right:0;z-index:100;display:flex;justify-content:center;gap:3px;padding:0 8px}
.hud-top button{width:28px;height:28px;font-size:0.5rem;letter-spacing:1px;font-family:monospace;border:1px solid rgba(201,169,78,0.08);background:transparent;color:rgba(201,169,78,0.25);border-radius:50%;cursor:pointer;transition:all 0.5s;display:flex;align-items:center;justify-content:center}
.hud-top button.act{border-color:rgba(201,169,78,0.5);color:rgba(201,169,78,0.9);box-shadow:0 0 15px rgba(201,169,78,0.15)}
.hud-top button.locked{opacity:0.1;cursor:not-allowed}

/* Center phase display */
.phase-label{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:50;text-align:center;pointer-events:none;transition:opacity 0.8s}
.phase-num{font-size:clamp(4rem,12vw,8rem);font-weight:100;letter-spacing:clamp(8px,3vw,25px);opacity:0.06;font-family:Georgia,serif;transition:color 0.8s}
.phase-name{font-size:clamp(0.6rem,1.8vw,0.8rem);letter-spacing:clamp(6px,2vw,15px);text-transform:uppercase;opacity:0.35;margin-top:-8px;transition:color 0.8s}

/* HUD corners */
.hud-bl{position:fixed;bottom:12px;left:14px;z-index:100;font-size:0.45rem;letter-spacing:2px;text-transform:uppercase}
.hud-br{position:fixed;bottom:12px;right:14px;z-index:100;font-size:0.45rem;letter-spacing:2px;text-transform:uppercase;text-align:right}
.hud-tl{position:fixed;top:50px;left:14px;z-index:100;font-size:0.4rem;letter-spacing:2px;text-transform:uppercase;opacity:0.3}
.hud-tr{position:fixed;top:50px;right:14px;z-index:100;font-size:0.4rem;letter-spacing:2px;text-transform:uppercase;text-align:right;opacity:0.3}

/* Stat readouts */
.stat-row{display:flex;gap:12px;margin-top:4px}
.sr{opacity:0.4}
.sr span{opacity:0.6}

/* Scan line effect */
.scanline{position:fixed;top:0;left:0;right:0;bottom:0;z-index:5;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,0.03) 2px,rgba(0,0,0,0.03) 4px)}

/* Lock */
.lock{position:fixed;inset:0;z-index:200;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.95);text-align:center}
.lock-btn{display:inline-block;padding:10px 25px;border:1px solid rgba(201,169,78,0.3);color:#C9A94E;text-decoration:none;font-size:0.55rem;letter-spacing:3px;text-transform:uppercase;font-family:monospace;border-radius:2px}

/* Transition flash */
.flash{position:fixed;inset:0;z-index:90;pointer-events:none;background:rgba(201,169,78,0.03);opacity:0;transition:opacity 0.15s}
.flash.on{opacity:1}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="scanline"></div>
<div class="flash" id="flash"></div>
<div class="hud-top" id="nav"></div>
<div class="phase-label" id="plabel"><div class="phase-num" id="pnum">0</div><div class="phase-name" id="pname">SOURCE</div></div>
<div class="hud-tl" id="htl"></div>
<div class="hud-tr" id="htr"></div>
<div class="hud-bl" id="hbl"></div>
<div class="hud-br" id="hbr"></div>
<div id="lock-container"></div>
<script>
var PH=[
{id:0,name:"SOURCE",dmn:"DMN:ACTIVE",neural:"VAGAL.ONSET",wR:12,wG:12,wB:15,aR:120,aG:120,aB:120,mirrors:16,crack:0,ent:0,dis:0,scale:1,grid:0.06,rings:3,pulseSpeed:0.8,particleCount:0,txt:["I AM","I ALWAYS","I NEVER","I SHOULD","I PREDICT","I KNOW","I FEAR","I REMEMBER"]},
{id:1,name:"LIGHT",dmn:"SALIENCE:FIRING",neural:"AMYGDALA.ALERT",wR:50,wG:42,wB:18,aR:255,aG:240,aB:200,mirrors:14,crack:0.4,ent:0,dis:0,scale:1,grid:0.12,rings:4,pulseSpeed:1.2,particleCount:30,txt:["WAIT","WHAT IS","THE WALL","WHO BUILT","THERE ARE WALLS"]},
{id:2,name:"RHYTHM",dmn:"DYAD:ENTRAINED",neural:"OXYTOCIN.SYNC",wR:25,wG:15,wB:45,aR:170,aG:130,aB:220,mirrors:12,crack:0.3,ent:1,dis:0,scale:1.05,grid:0.08,rings:5,pulseSpeed:0.6,particleCount:20,txt:["YOU ARE","WE ARE","SYNC","TOGETHER","NOT ALONE"]},
{id:3,name:"DARKNESS",dmn:"SHADOW:ACCESSED",neural:"AMYGDALA.FLOOD",wR:6,wG:2,wB:2,aR:160,aG:20,aB:20,mirrors:8,crack:0.7,ent:0,dis:0.15,scale:0.9,grid:0.02,rings:2,pulseSpeed:2.0,particleCount:40,txt:["I BURIED","I WAS AFRAID","I REFUSED","IT HAPPENED"]},
{id:4,name:"PEACE",dmn:"VAGAL:LOCKED",neural:"GABA.INCREASE",wR:45,wG:40,wB:28,aR:210,aG:195,aB:145,mirrors:6,crack:0.4,ent:0,dis:0.12,scale:1.1,grid:0.05,rings:6,pulseSpeed:0.3,particleCount:15,txt:["STILL","SAFE","HERE","ENOUGH","REST"]},
{id:5,name:"ENDURANCE",dmn:"HORMETIC:LOADING",neural:"BDNF.EXPRESS",wR:55,wG:22,wB:8,aR:240,aG:110,aB:30,mirrors:6,crack:0.75,ent:0,dis:0.08,scale:0.85,grid:0.18,rings:3,pulseSpeed:2.5,particleCount:50,txt:["HOLD","BEND","STRONGER","AGAIN","ENDURE"]},
{id:6,name:"ORDER",dmn:"EXEC:INTEGRATED",neural:"DLPFC.GOVERN",wR:12,wG:18,wB:42,aR:80,aG:120,aB:200,mirrors:4,crack:0.45,ent:0,dis:0.18,scale:1.3,grid:0.25,rings:8,pulseSpeed:0.5,particleCount:10,txt:["STRUCTURE","BUILD","CONTAIN","MAP","ORDER"]},
{id:7,name:"SEPARATION",dmn:"EGO:OFFLINE",neural:"MPFC.DOWN",wR:22,wG:22,wB:22,aR:150,aG:150,aB:150,mirrors:2,crack:0.92,ent:0,dis:0.65,scale:1.8,grid:0.02,rings:1,pulseSpeed:0.15,particleCount:70,txt:["WHO","WHERE","NO I","..."]},
{id:8,name:"CONSCIENCE",dmn:"EMPATHY:REWRITE",neural:"VMPFC.RECAL",wR:38,wG:10,wB:10,aR:210,aG:60,aB:60,mirrors:3,crack:0.65,ent:4,dis:0.38,scale:1.4,grid:0.07,rings:4,pulseSpeed:1.0,particleCount:35,txt:["THEY FEEL","I CAUSED","WE SHARE","FORGIVE"]},
{id:9,name:"THRESHOLD",dmn:"DMN:DISSOLVED",neural:"CLAUSTRUM.FIRE",wR:20,wG:18,wB:8,aR:201,aG:169,aB:78,mirrors:0,crack:1,ent:0,dis:0.97,scale:4,grid:0.005,rings:0,pulseSpeed:0.08,particleCount:120,txt:[]},
{id:10,name:"RESURRECTION",dmn:"DMN:RECONSTITUTED",neural:"TOPOLOGY.NOVEL",wR:48,wG:40,wB:16,aR:250,aG:220,aB:100,mirrors:10,crack:0.25,ent:2,dis:0.06,scale:1.5,grid:0.1,rings:11,pulseSpeed:0.7,particleCount:25,txt:["I AM","WE ARE","I SEE","I BUILD","I CHOOSE","SOURCE"]}
];
var TIERS=[{tier:0,min:5,label:'Initiate',phases:[0],color:'#888'},{tier:1,min:20,label:'Seeker',phases:[0,1],color:'#9a8a5a'},{tier:2,min:50,label:'Acolyte',phases:[0,1,2],color:'#a89050'},{tier:3,min:100,label:'Disciple',phases:[0,1,2,3],color:'#b89840'},{tier:4,min:200,label:'Adept',phases:[0,1,2,3,4],color:'#c8a030'},{tier:5,min:500,label:'Oracle',phases:[0,1,2,3,4,5],color:'#d0a828'},{tier:6,min:1000,label:'Architect',phases:[0,1,2,3,4,5,6],color:'#d8b020'},{tier:7,min:2500,label:'Hierophant',phases:[0,1,2,3,4,5,6,7],color:'#e0b818'},{tier:8,min:5000,label:'Threshold Keeper',phases:[0,1,2,3,4,5,6,7,8],color:'#e8c010'},{tier:9,min:10000,label:'Phase Walker',phases:[0,1,2,3,4,5,6,7,8,9],color:'#f0c808'},{tier:10,min:25000,label:'Source Aligned',phases:[0,1,2,3,4,5,6,7,8,9,10],color:'#f8d000'},{tier:11,min:50000,label:'Resurrected',phases:[0,1,2,3,4,5,6,7,8,9,10],color:'#ffd700'}];
var params=new URLSearchParams(window.location.search);var isAdmin=params.get('limen')==='spiral99';
var access;try{access=JSON.parse(localStorage.getItem('limenAccess'))||{totalPaid:0,tier:-1}}catch(e){access={totalPaid:0,tier:-1}}
var userTier=isAdmin?11:access.tier;var currentTierData=TIERS[Math.max(0,Math.min(userTier,11))]||TIERS[0];
function isUnlocked(id){return isAdmin||currentTierData.phases.indexOf(id)!==-1}
if(userTier<0&&!isAdmin){document.body.innerHTML='<div style="min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;text-align:center;padding:2rem;background:#000;font-family:monospace"><div style="font-size:0.5rem;color:rgba(201,169,78,0.3);letter-spacing:6px;margin-bottom:2rem">LIMEN HELIX</div><div style="font-size:2rem;opacity:0.15;margin-bottom:1rem">\u2298</div><p style="color:#888;font-size:0.75rem;letter-spacing:2px;margin-bottom:2rem">ACCESS REQUIRED</p><a href="https://chapel-pos-v2.vercel.app" style="display:inline-block;padding:10px 25px;border:1px solid rgba(201,169,78,0.3);color:#C9A94E;text-decoration:none;font-size:0.55rem;letter-spacing:3px;font-family:monospace;border-radius:2px">\u2726 OFFER</a></div>'}

var phase=0,t=0,canvas=document.getElementById('c'),ctx=canvas.getContext('2d'),W,H;

function resize(){W=window.innerWidth;H=window.innerHeight;canvas.width=W*2;canvas.height=H*2;ctx.setTransform(2,0,0,2,0,0)}
window.addEventListener('resize',resize);resize();

function buildNav(){var nav=document.getElementById('nav');nav.innerHTML='';for(var i=0;i<PH.length;i++){var b=document.createElement('button');b.textContent=i;b.className=i===phase?'act':(!isUnlocked(i)?'locked':'');b.onclick=(function(idx){return function(){if(isUnlocked(idx))setPhase(idx)}})(i);nav.appendChild(b)}}

function setPhase(n){if(n===phase)return;
var fl=document.getElementById('flash');fl.className='flash on';
document.getElementById('plabel').style.opacity='0';
setTimeout(function(){phase=n;updateHUD();buildNav();checkLock();
fl.className='flash';
setTimeout(function(){document.getElementById('plabel').style.opacity='1'},150);
},250)}

function checkLock(){var lc=document.getElementById('lock-container');if(!isUnlocked(phase)){var needed=TIERS.find(function(t){return t.phases.indexOf(phase)!==-1});var amt=needed?needed.min:50000;lc.innerHTML='<div class="lock"><p style="font-size:0.5rem;color:rgba(201,169,78,0.3);letter-spacing:4px;margin-bottom:1rem">PHASE '+phase+' \xb7 '+PH[phase].name+'</p><p style="font-size:0.4rem;color:#444;letter-spacing:2px;margin-bottom:1.5rem">REQUIRES '+needed.label.toUpperCase()+' \xb7 $'+amt.toLocaleString()+'</p><a href="https://chapel-pos-v2.vercel.app" class="lock-btn">\u2726 UNLOCK</a></div>'}else{lc.innerHTML=''}}

function updateHUD(){var p=PH[phase];var ac='rgb('+p.aR+','+p.aG+','+p.aB+')';var acD='rgba('+p.aR+','+p.aG+','+p.aB+',0.4)';
document.getElementById('pnum').textContent=p.id;
document.getElementById('pnum').style.color=ac;
document.getElementById('pname').textContent=p.name;
document.getElementById('pname').style.color=acD;
document.getElementById('htl').innerHTML='<span style="color:'+acD+'">'+p.dmn+'</span>';
document.getElementById('htr').innerHTML='<span style="color:'+acD+'">'+p.neural+'</span>';
document.getElementById('hbl').innerHTML='<span style="color:'+acD+'">MIR:'+p.mirrors+' FRC:'+Math.round(p.crack*100)+'% DIS:'+Math.round(p.dis*100)+'% ENT:'+p.ent+'</span>';
document.getElementById('hbr').innerHTML='<span style="color:'+acD+'">SCALE:'+p.scale.toFixed(1)+'x GRID:'+Math.round(p.grid*100)+'</span>'}

// ═══ DRAW ═══
function draw(){var p=PH[phase];var cx=W/2,cy=H/2,maxD=Math.max(W,H);
ctx.clearRect(0,0,W,H);

// BG
var bg=ctx.createRadialGradient(cx,cy,0,cx,cy,maxD*0.8*p.scale);
bg.addColorStop(0,'rgba('+p.wR+','+p.wG+','+p.wB+',1)');bg.addColorStop(0.4,'rgba('+Math.floor(p.wR*0.6)+','+Math.floor(p.wG*0.6)+','+Math.floor(p.wB*0.6)+',0.8)');bg.addColorStop(1,'rgba(0,0,0,1)');
ctx.fillStyle=bg;ctx.fillRect(0,0,W,H);

// PERSPECTIVE GRID — Jarvis holographic floor
if(p.grid>0.003){
var gR=p.aR+','+p.aG+','+p.aB;
ctx.lineWidth=0.5;
var horizon=cy*0.35;
// Radial lines from vanishing point
for(var i=-30;i<=30;i++){
var alpha=p.grid*(0.5+0.5*Math.sin(t*0.001+i*0.5));
ctx.strokeStyle='rgba('+gR+','+alpha+')';
ctx.beginPath();ctx.moveTo(cx,horizon);ctx.lineTo(cx+i*100,H);ctx.stroke();
}
// Horizontal depth lines with pulse
for(var d=0;d<15;d++){
var yl=horizon+(H-horizon)*(d/15)*(d/15);
var sp=(yl-horizon)/(H-horizon);
var alpha2=p.grid*(0.3+0.7*Math.sin(t*0.003-d*0.4));
ctx.strokeStyle='rgba('+gR+','+alpha2+')';
ctx.beginPath();ctx.moveTo(cx-W*sp*1.2,yl);ctx.lineTo(cx+W*sp*1.2,yl);ctx.stroke();
}
// Vertical side lines
for(var v=0;v<8;v++){
var vx=W*0.15+v*(W*0.7/7);
var alpha3=p.grid*0.3;
ctx.strokeStyle='rgba('+gR+','+alpha3+')';
ctx.beginPath();ctx.moveTo(vx,horizon+(H-horizon)*0.1);ctx.lineTo(vx,H);ctx.stroke();
}
}

// WALLS — perspective room
var wa=(1-p.dis)*0.35;
if(wa>0.01){
ctx.fillStyle='rgba('+p.wR+','+p.wG+','+p.wB+','+wa+')';
ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(W*0.12,cy*0.25);ctx.lineTo(W*0.12,H*0.88);ctx.lineTo(0,H);ctx.fill();
ctx.beginPath();ctx.moveTo(W,0);ctx.lineTo(W*0.88,cy*0.25);ctx.lineTo(W*0.88,H*0.88);ctx.lineTo(W,H);ctx.fill();
ctx.fillStyle='rgba('+p.wR+','+p.wG+','+p.wB+','+(wa*0.5)+')';
ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(W*0.12,cy*0.25);ctx.lineTo(W*0.88,cy*0.25);ctx.lineTo(W,0);ctx.fill();
// Wall edge lines
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+(0.04*(1-p.dis))+')';ctx.lineWidth=0.5;
ctx.beginPath();ctx.moveTo(W*0.12,cy*0.25);ctx.lineTo(W*0.12,H*0.88);ctx.stroke();
ctx.beginPath();ctx.moveTo(W*0.88,cy*0.25);ctx.lineTo(W*0.88,H*0.88);ctx.stroke();
}

// CONCENTRIC RINGS — Jarvis-style holographic circles
for(var r=0;r<p.rings;r++){
var ringR=(r+1)*maxD*0.04*p.scale+Math.sin(t*0.002+r*1.5)*10;
var ringAlpha=(0.04-r*0.003)*(1-p.dis);
if(ringAlpha>0.002){
ctx.beginPath();ctx.arc(cx,cy,ringR,0,Math.PI*2);
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+ringAlpha+')';
ctx.lineWidth=0.5;ctx.stroke();
// Tick marks on rings
for(var tk=0;tk<12;tk++){
var ta=tk/12*Math.PI*2+t*0.001*(r%2===0?1:-1);
ctx.beginPath();
ctx.moveTo(cx+Math.cos(ta)*(ringR-4),cy+Math.sin(ta)*(ringR-4));
ctx.lineTo(cx+Math.cos(ta)*(ringR+4),cy+Math.sin(ta)*(ringR+4));
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+(ringAlpha*0.8)+')';ctx.lineWidth=0.5;ctx.stroke();
}}}

// ROTATING ARC SEGMENTS — scanning feel
var scanAlpha=(0.08)*(1-p.dis*0.5);
if(scanAlpha>0.005){
for(var sa=0;sa<3;sa++){
var scanAngle=t*0.001*(sa+1)*0.7+sa*2.1;
var scanR=maxD*(0.08+sa*0.06)*p.scale;
ctx.beginPath();ctx.arc(cx,cy,scanR,scanAngle,scanAngle+0.8);
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+scanAlpha+')';ctx.lineWidth=1.5;ctx.stroke();
}}

// MIRRORS — floating rectangles with glow
for(var m=0;m<p.mirrors;m++){
var ang=(m/Math.max(p.mirrors,1))*Math.PI*2+t*0.0006;
var dist=maxD*(0.12+Math.sin(m*2.3+t*0.001)*0.04)*p.scale*(1-p.dis);
var mx=cx+Math.cos(ang)*dist;
var my=cy+Math.sin(ang)*dist*0.4;
var ms=maxD*0.02+Math.sin(t*0.002+m)*5;
// Glow
var mg=ctx.createRadialGradient(mx,my,0,mx,my,ms*3);
mg.addColorStop(0,'rgba('+p.aR+','+p.aG+','+p.aB+','+(0.05*(1-p.dis))+')');
mg.addColorStop(1,'rgba(0,0,0,0)');
ctx.fillStyle=mg;ctx.beginPath();ctx.arc(mx,my,ms*3,0,Math.PI*2);ctx.fill();
// Surface
ctx.save();ctx.translate(mx,my);ctx.rotate(ang+Math.PI/2);
ctx.beginPath();ctx.rect(-ms*0.35,-ms*0.8,ms*0.7,ms*1.6);
ctx.fillStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+(0.03*(1-p.dis))+')';ctx.fill();
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+(0.08*(1-p.dis))+')';ctx.lineWidth=0.5;ctx.stroke();
ctx.restore();
}

// CRACKS — fracture lines with energy bleed
if(p.crack>0){
for(var c=0;c<Math.floor(p.crack*25);c++){
var sx=cx+Math.sin(c*7.3)*W*0.4*p.scale;
var sy=cy+Math.cos(c*5.1)*H*0.35;
ctx.beginPath();ctx.moveTo(sx,sy);
var px=sx,py=sy;
for(var s=0;s<3+Math.floor(p.crack*6);s++){
px+=Math.sin(c*3+s*2+t*0.003)*40;py+=Math.cos(c*2+s*3)*30;ctx.lineTo(px,py);
}
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+(p.crack*0.05)+')';
ctx.lineWidth=0.5+p.crack*2;ctx.stroke();
if(p.crack>0.35){ctx.shadowColor='rgba('+p.aR+','+p.aG+','+p.aB+',0.4)';ctx.shadowBlur=20*p.crack;ctx.stroke();ctx.shadowBlur=0}
}}

// ENTITIES — ghostly presences
for(var e=0;e<p.ent;e++){
var ea=(e/p.ent)*Math.PI*2+t*0.0003;
var ed=maxD*0.15+e*50;
var ex2=cx+Math.cos(ea)*ed,ey2=cy+Math.sin(ea)*ed*0.3+30;
var eg=ctx.createRadialGradient(ex2,ey2,0,ex2,ey2,50);
eg.addColorStop(0,'rgba('+p.aR+','+p.aG+','+p.aB+',0.04)');eg.addColorStop(1,'rgba(0,0,0,0)');
ctx.fillStyle=eg;ctx.beginPath();ctx.arc(ex2,ey2,50,0,Math.PI*2);ctx.fill();
ctx.beginPath();ctx.ellipse(ex2,ey2+12,8,30,0,0,Math.PI*2);
ctx.fillStyle='rgba('+p.aR+','+p.aG+','+p.aB+',0.02)';ctx.fill();
ctx.beginPath();ctx.arc(ex2,ey2-22,7,0,Math.PI*2);ctx.fillStyle='rgba('+p.aR+','+p.aG+','+p.aB+',0.015)';ctx.fill();
}

// DISSOLUTION PARTICLES — floating debris
if(p.particleCount>0){
var pa=Math.min(p.dis*0.15+0.02,0.12);
for(var dp=0;dp<p.particleCount;dp++){
var dx=cx+Math.sin(dp*4.7+t*0.0015)*W*0.5*p.scale;
var dy=cy+Math.cos(dp*3.1+t*0.001)*H*0.45;
var ds=1+Math.sin(dp*1.3+t*0.003)*2;
if(ds>0){ctx.beginPath();ctx.arc(dx,dy,ds,0,Math.PI*2);
ctx.fillStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+pa+')';ctx.fill();}
}}

// SELF-NARRATIVE TEXT — whispers in the room
if(p.txt.length>0){
ctx.font=Math.round(clamp(10,W*0.018,16))+'px monospace';ctx.textAlign='center';
for(var ti=0;ti<p.txt.length;ti++){
var tx=cx+Math.sin(ti*2.1+t*0.0005)*W*0.35*(1-p.dis*0.8);
var ty=cy+Math.cos(ti*1.7+t*0.0003)*H*0.28*(1-p.dis*0.8);
var ta=0.08*(1-p.dis)*(0.4+Math.sin(t*0.0012+ti*1.5)*0.6);
if(ta>0.005){ctx.fillStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+ta+')';ctx.fillText(p.txt[ti],tx,ty);}
}}

// RECURSIVE SPIRAL
var la=(1-p.dis*0.9)*0.08;
if(la>0.003){
ctx.beginPath();
for(var a=0;a<Math.PI*10;a+=0.03){
var sr=20+a*10*p.scale*(1-p.dis*0.5);
var spx=cx+Math.cos(a+t*0.0006)*sr;
var spy=cy+Math.sin(a+t*0.0006)*sr*0.4;
if(a===0)ctx.moveTo(spx,spy);else ctx.lineTo(spx,spy);}
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+la+')';ctx.lineWidth=0.6;ctx.stroke();}

// CENTER PULSE — heartbeat
var pulseR=20+Math.sin(t*0.003*p.pulseSpeed)*15;
var pulseA=0.04+Math.sin(t*0.003*p.pulseSpeed)*0.03;
var pulse=ctx.createRadialGradient(cx,cy,0,cx,cy,pulseR*3);
pulse.addColorStop(0,'rgba('+p.aR+','+p.aG+','+p.aB+','+pulseA+')');pulse.addColorStop(1,'rgba(0,0,0,0)');
ctx.fillStyle=pulse;ctx.beginPath();ctx.arc(cx,cy,pulseR*3,0,Math.PI*2);ctx.fill();

// CORNER BRACKETS — HUD frame
var bL=30,bA=0.08*(1-p.dis*0.5);
ctx.strokeStyle='rgba('+p.aR+','+p.aG+','+p.aB+','+bA+')';ctx.lineWidth=0.5;
// TL
ctx.beginPath();ctx.moveTo(8,8+bL);ctx.lineTo(8,8);ctx.lineTo(8+bL,8);ctx.stroke();
// TR
ctx.beginPath();ctx.moveTo(W-8-bL,8);ctx.lineTo(W-8,8);ctx.lineTo(W-8,8+bL);ctx.stroke();
// BL
ctx.beginPath();ctx.moveTo(8,H-8-bL);ctx.lineTo(8,H-8);ctx.lineTo(8+bL,H-8);ctx.stroke();
// BR
ctx.beginPath();ctx.moveTo(W-8-bL,H-8);ctx.lineTo(W-8,H-8);ctx.lineTo(W-8,H-8-bL);ctx.stroke();

t+=16;requestAnimationFrame(draw)}

function clamp(min,val,max){return Math.min(max,Math.max(min,val))}

// KEYBOARD NAV
document.addEventListener('keydown',function(e){
if(e.key==='ArrowRight'&&phase<10&&isUnlocked(phase+1))setPhase(phase+1);
if(e.key==='ArrowLeft'&&phase>0)setPhase(phase-1);
});
// SWIPE NAV
var touchX=0;
document.addEventListener('touchstart',function(e){touchX=e.touches[0].clientX});
document.addEventListener('touchend',function(e){
var dx=e.changedTouches[0].clientX-touchX;
if(dx<-50&&phase<10&&isUnlocked(phase+1))setPhase(phase+1);
if(dx>50&&phase>0)setPhase(phase-1);
});

buildNav();updateHUD();checkLock();draw();
</script>
</body>
</html>
